\documentclass[a4paper]{article}
\usepackage[a4paper,left=3cm,right=2cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage{palatino}
\usepackage[colorlinks=true,linkcolor=blue,citecolor=blue]{hyperref}
\usepackage{graphicx}
\usepackage{cp2122t}
\usepackage{subcaption}
\usepackage{trees}
\usepackage{adjustbox}
\usepackage{color}
\definecolor{red}{RGB}{255,  0,  0}
\definecolor{blue}{RGB}{0,0,255}
\def\red{\color{red}}
\def\blue{\color{blue}}
%================= local x=====================================================%
\def\getGif#1{\includegraphics[width=0.3\textwidth]{cp2122t_media/#1.png}}
\let\uk=\emph
\def\aspas#1{``#1"}
%================= lhs2tex=====================================================%
%% ODER: format ==         = "\mathrel{==}"
%% ODER: format /=         = "\neq "
%
%
\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}%
  {\@namedef{lhs2tex.lhs2tex.sty.read}{}%
   \newcommand\SkipToFmtEnd{}%
   \newcommand\EndFmtInput{}%
   \long\def\SkipToFmtEnd#1\EndFmtInput{}%
  }\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
  {<5><6><7><8>cmtex8
   <9>cmtex9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
  {<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
  {<5><6><7><8>cmtt8
   <9>cmbtt9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
  {<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	% NEU

\newcommand{\Sp}{\hskip.33334em\relax}


\newcommand{\Conid}[1]{\mathit{#1}}
\newcommand{\Varid}[1]{\mathit{#1}}
\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
\newcommand{\plus}{\mathbin{+\!\!\!+}}
\newcommand{\bind}{\mathbin{>\!\!\!>\mkern-6.7mu=}}
\newcommand{\rbind}{\mathbin{=\mkern-6.7mu<\!\!\!<}}% suggested by Neil Mitchell
\newcommand{\sequ}{\mathbin{>\!\!\!>}}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\usepackage{polytable}

%mathindent has to be defined
\@ifundefined{mathindent}%
  {\newdimen\mathindent\mathindent\leftmargini}%
  {}%

\def\resethooks{%
  \global\let\SaveRestoreHook\empty
  \global\let\ColumnHook\empty}
\newcommand*{\savecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\savecolumns[#1]}}
\newcommand*{\restorecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\restorecolumns[#1]}}
\newcommand*{\aligncolumn}[2]%
  {\g@addto@macro\ColumnHook{\column{#1}{#2}}}

\resethooks

\newcommand{\onelinecommentchars}{\quad-{}- }
\newcommand{\commentbeginchars}{\enskip\{-}
\newcommand{\commentendchars}{-\}\enskip}

\newcommand{\visiblecomments}{%
  \let\onelinecomment=\onelinecommentchars
  \let\commentbegin=\commentbeginchars
  \let\commentend=\commentendchars}

\newcommand{\invisiblecomments}{%
  \let\onelinecomment=\empty
  \let\commentbegin=\empty
  \let\commentend=\empty}

\visiblecomments

\newlength{\blanklineskip}
\setlength{\blanklineskip}{0.66084ex}

\newcommand{\hsindent}[1]{\quad}% default is fixed indentation
\let\hspre\empty
\let\hspost\empty
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{$\langle$\textbf{To do:}~#1$\rangle$}

\EndFmtInput
\makeatother
%
%
%
%
%
%
% This package provides two environments suitable to take the place
% of hscode, called "plainhscode" and "arrayhscode". 
%
% The plain environment surrounds each code block by vertical space,
% and it uses \abovedisplayskip and \belowdisplayskip to get spacing
% similar to formulas. Note that if these dimensions are changed,
% the spacing around displayed math formulas changes as well.
% All code is indented using \leftskip.
%
% Changed 19.08.2004 to reflect changes in colorcode. Should work with
% CodeGroup.sty.
%
\ReadOnlyOnce{polycode.fmt}%
\makeatletter

\newcommand{\hsnewpar}[1]%
  {{\parskip=0pt\parindent=0pt\par\vskip #1\noindent}}

% can be used, for instance, to redefine the code size, by setting the
% command to \small or something alike
\newcommand{\hscodestyle}{}

% The command \sethscode can be used to switch the code formatting
% behaviour by mapping the hscode environment in the subst directive
% to a new LaTeX environment.

\newcommand{\sethscode}[1]%
  {\expandafter\let\expandafter\hscode\csname #1\endcsname
   \expandafter\let\expandafter\endhscode\csname end#1\endcsname}

% "compatibility" mode restores the non-polycode.fmt layout.

\newenvironment{compathscode}%
  {\par\noindent
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \let\hspre\(\let\hspost\)%
   \pboxed}%
  {\endpboxed\)%
   \par\noindent
   \ignorespacesafterend}

\newcommand{\compaths}{\sethscode{compathscode}}

% "plain" mode is the proposed default.
% It should now work with \centering.
% This required some changes. The old version
% is still available for reference as oldplainhscode.

\newenvironment{plainhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\hspre\(\let\hspost\)%
   \pboxed}%
  {\endpboxed%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

\newenvironment{oldplainhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \(\pboxed}%
  {\endpboxed\)%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

% Here, we make plainhscode the default environment.

\newcommand{\plainhs}{\sethscode{plainhscode}}
\newcommand{\oldplainhs}{\sethscode{oldplainhscode}}
\plainhs

% The arrayhscode is like plain, but makes use of polytable's
% parray environment which disallows page breaks in code blocks.

\newenvironment{arrayhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \(\parray}%
  {\endparray\)%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

\newcommand{\arrayhs}{\sethscode{arrayhscode}}

% The mathhscode environment also makes use of polytable's parray 
% environment. It is supposed to be used only inside math mode 
% (I used it to typeset the type rules in my thesis).

\newenvironment{mathhscode}%
  {\parray}{\endparray}

\newcommand{\mathhs}{\sethscode{mathhscode}}

% texths is similar to mathhs, but works in text mode.

\newenvironment{texthscode}%
  {\(\parray}{\endparray\)}

\newcommand{\texths}{\sethscode{texthscode}}

% The framed environment places code in a framed box.

\def\codeframewidth{\arrayrulewidth}
\RequirePackage{calc}

\newenvironment{framedhscode}%
  {\parskip=\abovedisplayskip\par\noindent
   \hscodestyle
   \arrayrulewidth=\codeframewidth
   \tabular{@{}|p{\linewidth-2\arraycolsep-2\arrayrulewidth-2pt}|@{}}%
   \hline\framedhslinecorrect\\{-1.5ex}%
   \let\endoflinesave=\\
   \let\\=\@normalcr
   \(\pboxed}%
  {\endpboxed\)%
   \framedhslinecorrect\endoflinesave{.5ex}\hline
   \endtabular
   \parskip=\belowdisplayskip\par\noindent
   \ignorespacesafterend}

\newcommand{\framedhslinecorrect}[2]%
  {#1[#2]}

\newcommand{\framedhs}{\sethscode{framedhscode}}

% The inlinehscode environment is an experimental environment
% that can be used to typeset displayed code inline.

\newenvironment{inlinehscode}%
  {\(\def\column##1##2{}%
   \let\>\undefined\let\<\undefined\let\\\undefined
   \newcommand\>[1][]{}\newcommand\<[1][]{}\newcommand\\[1][]{}%
   \def\fromto##1##2##3{##3}%
   \def\nextline{}}{\) }%

\newcommand{\inlinehs}{\sethscode{inlinehscode}}

% The joincode environment is a separate environment that
% can be used to surround and thereby connect multiple code
% blocks.

\newenvironment{joincode}%
  {\let\orighscode=\hscode
   \let\origendhscode=\endhscode
   \def\endhscode{\def\hscode{\endgroup\def\@currenvir{hscode}\\}\begingroup}
   %\let\SaveRestoreHook=\empty
   %\let\ColumnHook=\empty
   %\let\resethooks=\empty
   \orighscode\def\hscode{\endgroup\def\@currenvir{hscode}}}%
  {\origendhscode
   \global\let\hscode=\orighscode
   \global\let\endhscode=\origendhscode}%

\makeatother
\EndFmtInput
%
\def\ana#1{\mathopen{[\!(}#1\mathclose{)\!]}}
%%format (bin (n) (k)) = "\Big(\vcenter{\xymatrix@R=1pt{" n "\\" k "}}\Big)"
\newlabel{eq:fokkinga}{{3.93}{110}{The mutual-recursion law}{section.3.17}{}}
\def\plus{\mathbin{\dagger}}

%---------------------------------------------------------------------------

\title{
          Cálculo de Programas
\\
          Trabalho Prático
\\
          LEI+MiEI --- 2021/22
}

\author{
          \dium
\\
          Universidade do Minho
}


\date\mydate

\makeindex
\newcommand{\rn}[1]{\textcolor{red}{#1}}
\begin{document}

\maketitle

\begin{center}\large
\begin{tabular}{ll}
\textbf{Grupo} nr. & 4
\\\hline
a93290 & Joana Maia Teixeira Alves
\\
a93264 & Maria Eugénia Bessa Cunha
\\
a93296 & Vicente Gonçalves Moreira
\end{tabular}
\end{center}

\section{Preâmbulo}

\CP\ tem como objectivo principal ensinar
a progra\-mação de computadores como uma disciplina científica. Para isso
parte-se de um repertório de \emph{combinadores} que formam uma álgebra da
programação (conjunto de leis universais e seus corolários) e usam-se esses
combinadores para construir programas \emph{composicionalmente}, isto é,
agregando programas já existentes.

Na sequência pedagógica dos planos de estudo dos cursos que têm
esta disciplina, opta-se pela aplicação deste método à programação
em \Haskell\ (sem prejuízo da sua aplicação a outras linguagens
funcionais). Assim, o presente trabalho prático coloca os
alunos perante problemas concretos que deverão ser implementados em
\Haskell.  Há ainda um outro objectivo: o de ensinar a documentar
programas, a validá-los e a produzir textos técnico-científicos de
qualidade.

Antes de abodarem os problemas propostos no trabalho, os grupos devem ler
com atenção o anexo \ref{sec:documentacao} onde encontrarão as instruções
relativas ao sofware a instalar, etc.


\Problema

Num sistema de informação distribuído, uma lista não vazia de transações
é vista como um \textit\blockchain\ sempre que possui um valor de \textit{hash}
que é dado pela raiz de uma \MerkleTree\ que lhe está associada. Isto significa
que cada \textit\blockchain\ está estruturado numa \MerkleTree.
Mas, o que é uma \MerkleTree?

Uma \MerkleTree\ é uma \FTree\ com as seguintes propriedades:
%
\begin{eqnarray}
\fbox{
\begin{minipage}{.85\textwidth}
\begin{enumerate}
\item as folhas são pares (\ensuremath{\Varid{hash}}, transação) ou simplesmente o \ensuremath{\Varid{hash}} de uma transação;
\item os nodos são \ensuremath{\Varid{hashes}} que correspondem à concatenação dos \ensuremath{\Varid{hashes}} dos filhos;
\item o \ensuremath{\Varid{hash}} que se encontra na raiz da árvore é designado \ensuremath{\Conid{Merkle}\;\Conid{Root}}; como se disse acima, corresponde ao valor de \ensuremath{\Varid{hash}} de todo o bloco de transações.
\end{enumerate}
\end{minipage}
}&&
     \label{eq:MTree_props}
\end{eqnarray}


\begin{figure}
\fbox{
\begin{minipage}{\textwidth}\em
\begin{itemize}
\item Se a lista for singular, calcular o \ensuremath{\Varid{hash}} da transação.

\item Caso contrário,
\begin{enumerate}
\item Mapear a lista com a função \ensuremath{\Varid{hash}}.

\item Se o comprimento da lista for ímpar, concatenar a lista com o seu último valor (que fica duplicado). Caso contrário, a lista não sofre alterações.

\item Agrupar a lista em pares.

\item Concatenar os \ensuremath{\Varid{hashes}} do par produzindo uma lista de (sub-)árvores nas quais a cabeça terá a respetiva concatenação.

\item Se a lista de (sub-)árvores não for singular, voltar ao passo 2 com a lista das cabeças como argumento, preservando a lista de (sub-)árvores. Se a lista for singular, chegamos à \ensuremath{\Conid{Merkle}\;\Conid{Root}}. Contudo, falta compor a \ensuremath{\Conid{Merkle}\;\Conid{Tree}} final. Para tal, tendo como resultado uma lista de listas de (sub-)árvores agrupada pelos níveis da árvore final, é necessário encaixar sucessivamente os tais níveis formando a \ensuremath{\Conid{Merkle}\;\Conid{Tree}} completa.
\end{enumerate}
\end{itemize}
\end{minipage}
}\caption{Algoritmo clássico de construção de uma \MerkleTree\ \cite{Se19} \label{fig:algMTree}.}
\end{figure}

Assumindo uma lista não vazia de transações, o algoritmo clássico de construção
de uma \ensuremath{\Conid{Merkle}\;\Conid{Tree}} é o que está dado na Figura \ref{fig:algMTree}. Contudo,
este algoritmo (que se pode mostrar ser um hilomorfismo de listas não vazias)
é demasiadamente complexo. Uma forma bem mais simples de produzir uma \ensuremath{\Conid{Merkle}\;\Conid{Tree}} é através de um hilomorfismo de \LTree s. Começa-se por, a partir da
lista de transações, construir uma \LTree\ cujas folhas são as transações:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{list2LTree}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to {\LTree}\;\Varid{a}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Depois, o objetivo é etiquetar essa árvore com os \ensuremath{\Varid{hashes}},
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{lTree2MTree}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow {\LTree}\;\Varid{a}\to \underbrace{{\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{a})}_{\Conid{Merkle}\;\Varid{tree}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
formando uma \MerkleTree\ que satisfaça os três requisitos em (\ref{eq:MTree_props}).
Em suma, a construção de um \blockchain\ é um hilomorfismo de \LTree s
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{computeMerkleTree}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow [\mskip1.5mu \Varid{a}\mskip1.5mu]\to {\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{computeMerkleTree}\mathrel{=}\Varid{lTree2MTree}\comp \Varid{list2LTree}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\begin{enumerate}
\item     Comece por definir o gene do anamorfismo que constrói \LTree s a partir de listas não vazias:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{list2LTree}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to {\LTree}\;\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{list2LTree}\mathrel{=}\mathopen{[\!(}\Varid{g\char95 list2LTree}\mathclose{)\!]}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\textbf{NB}: para garantir que \ensuremath{\Varid{list2LTree}} não aceita listas vazias deverá
usar em \ensuremath{\Varid{g\char95 list2LTree}} o inverso \ensuremath{\Varid{outNEList}} do isomorfismo
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{inNEList}\mathrel{=}\alt{\Varid{singl}}{\Varid{cons}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\item

Assumindo as seguintes funções \ensuremath{\Varid{hash}} e \ensuremath{\Varid{concHash}}:\footnote{Para invocar a função \ensuremath{\Varid{hash}}, escreva \ensuremath{\Varid{\Conid{Main}.hash}}.}

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{hash}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow \Varid{a}\to \mathbb{Z}{}\<[E]%
\\
\>[B]{}\Varid{hash}\mathrel{=}\Varid{toInteger}\comp (\Varid{\Conid{Data}.\Conid{Hashable}.hash}){}\<[E]%
\\
\>[B]{}\Varid{concHash}\mathbin{::}(\mathbb{Z},\mathbb{Z})\to \mathbb{Z}{}\<[E]%
\\
\>[B]{}\Varid{concHash}\mathrel{=}\Varid{add}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\noindent defina o gene do catamorfismo que consome a \LTree\ e produz
a correspondente \MerkleTree\ etiquetada com todos os \ensuremath{\Varid{hashes}}:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{lTree2MTree}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow {\LTree}\;\Varid{a}\to {\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{lTree2MTree}\mathrel{=}\llparenthesis\, \Varid{g\char95 lTree2MTree}\,\rrparenthesis{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\item Defina \ensuremath{\Varid{g\char95 mroot}} por forma a
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{mroot}\mathbin{::}\Conid{Hashable}\;\Varid{b}\Rightarrow [\mskip1.5mu \Varid{b}\mskip1.5mu]\to \mathbb{Z}{}\<[E]%
\\
\>[B]{}\Varid{mroot}\mathrel{=}\llparenthesis\, \Varid{g\char95 mroot}\,\rrparenthesis\comp \Varid{computeMerkleTree}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
nos dar a Merkle \emph{root} de um qualquer bloco \ensuremath{[\mskip1.5mu \Varid{b}\mskip1.5mu]} de transações.

\item

Calcule \ensuremath{\Varid{mroot}\;\Varid{trs}} da sequência de transações \ensuremath{\Varid{trs}} da no anexo e verifique que, sempre que se modifica (e.g.\ fraudulentamente) uma transação passada em \ensuremath{\Varid{trs}}, \ensuremath{\Varid{mroot}\;\Varid{trs}} altera-se necessariamente. Porquê? (Esse é exactamente o princípio de funcionamento da tecnologia \blockchain.)
\end{enumerate}

\begin{quote}\small
\vskip 1em \hrule \vskip 1em
\textbf{Valorização} (não obrigatória): implemente o algoritmo clássico de
construção de \MerkleTree s
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{classicMerkleTree}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow [\mskip1.5mu \Varid{a}\mskip1.5mu]\to {\FTree}\;\mathbb{Z}\;\mathbb{Z}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
sob a forma de um hilomorfismo de listas não vazias.
Para isso deverá definir esse combinador primeiro, da forma habitual:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{hyloNEList}\;\Varid{h}\;\Varid{g}\mathrel{=}\Varid{cataNEList}\;\Varid{h}\comp \Varid{anaNEList}\;\Varid{g}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
etc.
Depois passe à definição do gene \ensuremath{\Varid{g\char95 pairsList}} do anamorfismo de listas
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{pairsList}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu (\Varid{a},\Varid{a})\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{pairsList}\mathrel{=}\anaList{\Varid{g\char95 pairsList}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
que agrupa a lista argumento por pares, duplicando o último valor caso seja necessário. Para tal, poderá usar a função (já definida)
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{getEvenBlock}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
que, dada uma lista, se o seu comprimento for ímpar, duplica o último valor.

Por fim, defina os genes \ensuremath{\Varid{divide}} e \ensuremath{\Varid{conquer}} dos respetivos anamorfismo e catamorfimo por forma a
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{classicMerkleTree}\mathrel{=}(\Varid{hyloNEList}\;\Varid{conquer}\;\Varid{divide})\comp (\map \;\Varid{\Conid{Main}.hash}){}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Para facilitar a definição do \ensuremath{\Varid{conquer}}, terá apenas de definir o gene \ensuremath{\Varid{g\char95 mergeMerkleTree}} do catamorfismo de ordem superior
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{mergeMerkleTree}\mathbin{::}{\FTree}\;\Varid{a}\;\Varid{p}\to [\mskip1.5mu {\FTree}\;\Varid{a}\;\Varid{c}\mskip1.5mu]\to {\FTree}\;\Varid{a}\;\Varid{c}{}\<[E]%
\\
\>[B]{}\Varid{mergeMerkleTree}\mathrel{=}\llparenthesis\, \Varid{g\char95 mergeMerkleTree}\,\rrparenthesis{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
que compõe a \FTree\ (à cabeça) com a lista de \FTree s (como filhos), fazendo um ``merge'' dos valores intermédios. Veja o seguinte exemplo de aplicação da função \ensuremath{\Varid{mergeMerkleTree}}:
\begin{tabbing}\ttfamily
~~\char62{}~l~\char61{}~\char91{}Comp~3~\char40{}Unit~1\char44{}~Unit~2\char41{}\char44{}~Comp~7~\char40{}Unit~3\char44{}~Unit~4\char41{}\char93{}\\
\ttfamily ~~\char62{}~\\
\ttfamily ~~\char62{}~m~\char61{}~Comp~10~\char40{}Unit~3\char44{}~Unit~7\char41{}\\
\ttfamily ~~\char62{}~\\
\ttfamily ~~\char62{}~mergeMerkleTree~m~l\\
\ttfamily ~Comp~10~\char40{}Comp~3~\char40{}Unit~1\char44{}Unit~2\char41{}\char44{}Comp~7~\char40{}Unit~3\char44{}Unit~4\char41{}\char41{}
\end{tabbing}

\textbf{NB}: o \textit{classicMerkleTree} retorna uma Merkle Tree cujas folhas são apenas o \ensuremath{\Varid{hash}} da transação e não o par (\ensuremath{\Varid{hash}}, transação).
\vskip 1em \hrule \vskip 1em
\end{quote}

\Problema

Se se digitar \wc{\ensuremath{\Varid{man}\;\Varid{wc}}} na shell do Unix (Linux) obtém-se:
\begin{quote}\small
\begin{tabbing}\ttfamily
~NAME\\
\ttfamily ~~~~~~wc~\char45{}\char45{}~word\char44{}~line\char44{}~character\char44{}~and~byte~count\\
\ttfamily ~\\
\ttfamily ~SYNOPSIS\\
\ttfamily ~~~~~~wc~\char91{}\char45{}clmw\char93{}~\char91{}file~\char46{}\char46{}\char46{}\char93{}\\
\ttfamily ~\\
\ttfamily ~DESCRIPTION\\
\ttfamily ~~~~~The~wc~utility~displays~the~number~of~lines\char44{}~words\char44{}~and~bytes~contained~in\\
\ttfamily ~~~~~each~input~file\char44{}~~or~standard~input~\char40{}if~no~file~is~specified\char41{}~to~the~stan\char45{}\\
\ttfamily ~~~~~dard~~output\char46{}~~A~line~is~defined~as~~a~string~of~characters~delimited~by~a\\
\ttfamily ~~~~~\char60{}newline\char62{}~character\char46{}~~Characters~beyond~the~final~\char60{}newline\char62{}~character~will\\
\ttfamily ~~~~~not~be~included~in~the~line~count\char46{}\\
\ttfamily ~~~~~\char40{}\char46{}\char46{}\char46{}\char41{}\\
\ttfamily ~~~~~The~following~options~are~available\char58{}\\
\ttfamily ~~~~~\char40{}\char46{}\char46{}\char46{}\char41{}\\
\ttfamily ~~~~~~~~~\char45{}w~~~The~number~of~words~in~each~input~file~is~written~to~the~standard\\
\ttfamily ~~~~~~~~~~~~~~output\char46{}\\
\ttfamily ~~~~~\char40{}\char46{}\char46{}\char46{}\char41{}
\end{tabbing}
\end{quote}
Se olharmos para o código da função que, em C, implementa esta funcionalidade
\cite{KR78} e nos focarmos apenas na parte que implementa a opção \text{\ttfamily \char45{}w},
verificamos que a poderíamos escrever, em Haskell, da forma seguinte:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{6}{@{}>{\hspre}l<{\hspost}@{}}%
\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
\column{11}{@{}>{\hspre}l<{\hspost}@{}}%
\column{12}{@{}>{\hspre}l<{\hspost}@{}}%
\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{wc\char95 w}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{wc\char95 w}\;[\mskip1.5mu \mskip1.5mu]{}\<[12]%
\>[12]{}\mathrel{=}\mathrm{0}{}\<[E]%
\\
\>[B]{}\Varid{wc\char95 w}\;(\Varid{c}\mathbin{:}\Varid{l})\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{6}{}\<[6]%
\>[6]{}\mathbf{if}\;\neg \;(\Varid{sep}\;\Varid{c})\mathrel{\wedge}\Varid{lookahead\char95 sep}\;\Varid{l}\;\mathbf{then}\;\Varid{wc\char95 w}\;\Varid{l}\mathbin{+}\mathrm{1}\;\mathbf{else}\;\Varid{wc\char95 w}\;\Varid{l}{}\<[E]%
\\
\>[6]{}\hsindent{2}{}\<[8]%
\>[8]{}\mathbf{where}{}\<[E]%
\\
\>[8]{}\hsindent{3}{}\<[11]%
\>[11]{}\Varid{sep}\;\Varid{c}\mathrel{=}(\Varid{c}\equiv \text{\ttfamily '~'}\mathrel{\vee}\Varid{c}\equiv \text{\ttfamily '\char92 n'}\mathrel{\vee}\Varid{c}\equiv \text{\ttfamily '\char92 t'}){}\<[E]%
\\
\>[8]{}\hsindent{3}{}\<[11]%
\>[11]{}\Varid{lookahead\char95 sep}\;[\mskip1.5mu \mskip1.5mu]{}\<[31]%
\>[31]{}\mathrel{=}\Conid{True}{}\<[E]%
\\
\>[8]{}\hsindent{3}{}\<[11]%
\>[11]{}\Varid{lookahead\char95 sep}\;(\Varid{c}\mathbin{:}\Varid{l})\mathrel{=}\Varid{sep}\;\Varid{c}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Por aplicação da lei de recursividade mútua
\begin{eqnarray}
\ensuremath{\begin{lcbr}\Varid{f}\comp \mathsf{in}\mathrel{=}\Varid{h}\comp \fun F \;\conj{\Varid{f}}{\Varid{g}}\\\Varid{g}\comp \mathsf{in}\mathrel{=}\Varid{k}\comp \fun F \;\conj{\Varid{f}}{\Varid{g}}\end{lcbr}}
     & \equiv &
     \ensuremath{\conj{\Varid{f}}{\Varid{g}}\mathrel{=}\cata{\conj{\Varid{h}}{\Varid{k}}}}
\end{eqnarray}
às funções \ensuremath{\Varid{wc\char95 w}} e \ensuremath{\Varid{lookahead\char95 sep}}, re-implemente a primeira segundo o
modelo \emph{\ensuremath{\Varid{worker}}/\ensuremath{\Varid{wrapper}}} onde \ensuremath{\Varid{worker}} deverá ser um catamorfismo
de listas:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{wc\char95 w\char95 final}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{wc\char95 w\char95 final}\mathrel{=}\Varid{wrapper}\comp \underbrace{\cataList{\alt{\Varid{g1}}{\Varid{g2}}}}_{\Varid{worker}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Apresente os cálculos que fez para chegar à versão \ensuremath{\Varid{wc\char95 w\char95 final}} de \ensuremath{\Varid{wc\char95 w}},
com indicação dos genes \ensuremath{\Varid{h}}, \ensuremath{\Varid{k}} e \ensuremath{\Varid{g}\mathrel{=}\alt{\Varid{g1}}{\Varid{g2}}}.

\Problema

Neste problema pretende-se gerar o HTML de uma página de um jornal descrita
como uma agregação estruturada de blocos de texto ou imagens:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{Unit}\;\Varid{a}\;\Varid{b}\mathrel{=}\Conid{Image}\;\Varid{a}\mid \Conid{Text}\;\Varid{b}\;\mathbf{deriving}\;\Conid{Show}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
O tipo \ensuremath{\Conid{Sheet}} (=``página de jornal'')
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{Sheet}\;\Varid{a}\;\Varid{b}\;\Varid{i}\mathrel{=}\Conid{Rect}\;(\Conid{Frame}\;\Varid{i})\;(\Conid{X}\;(\Conid{Unit}\;\Varid{a}\;\Varid{b})\;(\Conid{Mode}\;\Varid{i}))\;\mathbf{deriving}\;\Conid{Show}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
é baseado num tipo indutivo $X$ que, dado em anexo (pág.~\pageref{sec:C}),
exprime a partição de um rectângulo (a página tipográfica) em vários subrectângulos
(as caixas tipográficas a encher com texto ou imagens),
segundo um processo de partição binária, na horizontal ou na vertical.
Para isso, o tipo
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{Mode}\;\Varid{i}\mathrel{=}\Conid{Hr}\;\Varid{i}\mid \Conid{Hl}\;\Varid{i}\mid \Conid{Vt}\;\Varid{i}\mid \Conid{Vb}\;\Varid{i}\;\mathbf{deriving}\;\Conid{Show}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
especifica quatro variantes de partição. O seu argumento deverá
ser um número de 0 a 1, indicando a fracção da altura (ou da largura) em que o
rectângulo é dividido, a saber:
\begin{itemize}
\item \texttt{Hr i} ---  partição horizontal, medindo $i$ a partir da direita
\item \texttt{Hl i} ---  partição horizontal, medindo $i$ a partir da esquerda
\item \texttt{Vt i} ---  partição vertical, medindo $i$ a partir do topo
\item \texttt{Vb i} ---  partição vertical, medindo $i$ a partir da base
\end{itemize}

Por exemplo, a partição dada na figura \ref{fig:1} corresponde à partição
de um rectângulo de acordo com a seguinte árvore de partições:
%
\begin{eqnarray*}
\mbox{
\tree{\ensuremath{\Conid{Hl}\;(\mathrm{0.41})}}
\subtree{\ensuremath{\Conid{Vt}\;(\mathrm{0.48})}}
\leaf{\ensuremath{\Varid{c}}}
\subtree{\ensuremath{\Conid{Vt}\;(\mathrm{0.36})}}
\leaf{\ensuremath{\Varid{d}}}
\leaf{\ensuremath{\Varid{e}}}
\endsubtree
\endsubtree
\subtree{\ensuremath{\Conid{Vb}\;(\mathrm{0.6})}}
\leaf{\ensuremath{\Varid{a}}}
\leaf{\ensuremath{\Varid{b}}}
\endsubtree
\endtree
}
\end{eqnarray*}

\begin{figure}
\begin{center}
\unitlength=.05mm
\special{em:linewidth 0.2pt}
\begin{picture}(780.00,960.00)
\put(0.00,0.00){\makebox(320,320)[cc]{$e$}}
\put(0.00,0.00){\line(1,0){320.00}}
\put(0.00,0.00){\line(0,1){320.00}}
\put(0.00,320.00){\line(1,0){320.00}}
\put(320.00,0.00){\line(0,1){320.00}}
\put(0.00,320.00){\makebox(320,180)[cc]{$d$}}
\put(0.00,320.00){\line(0,1){180.00}}
\put(0.00,500.00){\line(1,0){320.00}}
\put(320.00,320.00){\line(0,1){180.00}}
\put(0.00,500.00){\makebox(320,460)[cc]{$c$}}
\put(0.00,500.00){\line(0,1){460.00}}
\put(0.00,960.00){\line(1,0){320.00}}
\put(320.00,500.00){\line(0,1){460.00}}
\put(320.00,0.00){\makebox(460,580)[cc]{$ b$}}
\put(320.00,0.00){\line(1,0){460.00}}
\put(320.00,0.00){\line(0,1){580.00}}
\put(320.00,580.00){\line(1,0){460.00}}
\put(780.00,0.00){\line(0,1){580.00}}
\put(320.00,580.00){\makebox(460,380)[cc]{$a $}}
\put(320.00,580.00){\line(0,1){380.00}}
\put(320.00,960.00){\line(1,0){460.00}}
\put(780.00,580.00){\line(0,1){380.00}}
\end{picture}
\end{center}
\caption{Layout de página de jornal.\label{fig:1}}
\end{figure}

As caixas delineadas por uma partição (como a dada acima) correspondem a
folhas da árvore de partição e podem conter texto ou imagens. É o que
se verifica no objecto \ensuremath{\Varid{example}} da secção \ref{sec:test_data}
que, processado por \ensuremath{\Varid{sheet2html}} (secção \ref{sec:html})
vem a produzir o ficheiro \texttt{jornal.html}.

\paragraph{O que se pretende}
O código em \Haskell\ fornecido no anexo \ref{sec:codigo}
como ``kit'' para arranque deste trabalho não está estruturado
em termos dos combinadores \emph{cata-ana-hylo} estudados nesta disciplina.
%
O que se pretende é, então:
\begin{enumerate}
\item     A construção de uma biblioteca ``pointfree''
     \footnote{%
          A desenvolver de forma análoga a outras bibliotecas que
          conhece (\eg\ \LTree, etc).
}
     com base na qual o processamento (``pointwise'') já disponível
     possa ser redefinido.
\item     A evolução da biblioteca anterior para uma outra que permita
     partições $n$-árias (para \emph{qualquer} $n$ finito)
     e não apenas binárias. \footnote{
          Repare que é a falta desta capacidade expressiva
          que origina, no ``kit'' actual, a definição das funções
          auxiliares  da secção \ref{sec:faux}, por exemplo.
     }
\end{enumerate}

\Problema

Este exercício tem como objectivo determinar todos os caminhos
possíveis de um ponto \emph{A} para um ponto \emph{B}. Para tal,
iremos utilizar técnicas de
\href{https://en.wikipedia.org/wiki/Brute-force_search}{\emph{brute
force}} e
\href{https://en.wikipedia.org/wiki/Backtracking}{\emph{backtracking}}, que podem
ser codificadas no \listM{mónade das listas} (estudado na \href{https://haslab.github.io/CP/Material/}{aulas}). Comece por implementar a seguinte função auxiliar:

\begin{enumerate}
\item \ensuremath{\Varid{pairL}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu (\Varid{a},\Varid{a})\mskip1.5mu]} que dada uma lista \ensuremath{\Varid{l}} de tamanho
maior que \ensuremath{\mathrm{1}} produz uma nova lista cujos elementos são os pares \ensuremath{(\Varid{x},\Varid{y})} de
elementos de \ensuremath{\Varid{l}} tal que \ensuremath{\Varid{x}} precede imediatamente \ensuremath{\Varid{y}}. Por exemplo:
\begin{quote}
     \ensuremath{\Varid{pairL}\;[\mskip1.5mu \mathrm{1},\mathrm{2}\mskip1.5mu]\equiv [\mskip1.5mu (\mathrm{1},\mathrm{2})\mskip1.5mu]},
\\
     \ensuremath{\Varid{pairL}\;[\mskip1.5mu \mathrm{1},\mathrm{2},\mathrm{3}\mskip1.5mu]\equiv [\mskip1.5mu (\mathrm{1},\mathrm{2}),(\mathrm{2},\mathrm{3})\mskip1.5mu]} e
\\
     \ensuremath{\Varid{pairL}\;[\mskip1.5mu \mathrm{1},\mathrm{2},\mathrm{3},\mathrm{4}\mskip1.5mu]\equiv [\mskip1.5mu (\mathrm{1},\mathrm{2}),(\mathrm{2},\mathrm{3}),(\mathrm{3},\mathrm{4})\mskip1.5mu]}
\end{quote}
Para o caso em que \ensuremath{\Varid{l}\mathrel{=}[\mskip1.5mu \Varid{x}\mskip1.5mu]}, i.e. o tamanho de \ensuremath{\Varid{l}} é \ensuremath{\mathrm{1}}, assuma que \ensuremath{\Varid{pairL}\;[\mskip1.5mu \Varid{x}\mskip1.5mu]\equiv [\mskip1.5mu (\Varid{x},\Varid{x})\mskip1.5mu]}. Implemente esta função como um \emph{anamorfismo de listas}, atentando na sua propriedade:

\begin{itemize}\em
\item      Para todas as listas \ensuremath{\Varid{l}} de tamanho maior que 1,
a lista \ensuremath{\map \;\p1\;(\Varid{pairL}\;\Varid{l})} é a lista original \ensuremath{\Varid{l}} a menos do último elemento.
Analogamente, a lista \ensuremath{\map \;\p2\;(\Varid{pairL}\;\Varid{l})}  é a lista original \ensuremath{\Varid{l}} a menos do primeiro elemento. 
\end{itemize}
\end{enumerate}


De seguida necessitamos de uma estrutura de dados representativa da noção de espaço,
para que seja possível formular a noção de \emph{caminho} de um ponto \ensuremath{\Conid{A}} para um ponto \ensuremath{\Conid{B}},
por exemplo, num papel quadriculado. No nosso caso vamos ter:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{Cell}\mathrel{=}\Conid{Free}\mid \Conid{Blocked}\mid {}\<[31]%
\>[31]{}\Conid{Lft}\mid \Conid{Rght}\mid \Conid{Up}\mid \Conid{Down}\;\mathbf{deriving}\;(\Conid{Eq},\Conid{Show}){}\<[E]%
\\
\>[B]{}\mathbf{type}\;\Conid{Map}\mathrel{=}[\mskip1.5mu [\mskip1.5mu \Conid{Cell}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

O terreno onde iremos navegar é codificado então numa \emph{matriz} de
células.  Os valores \emph{Free} and \emph{Blocked} denotam uma célula
como livre ou bloqueada, respectivamente (a navegação entre dois
pontos terá que ser realizada \emph{exclusivamente} através de células
livres). Ao correr, por exemplo, \ensuremath{\Varid{putStr}\mathbin{\$}\Varid{showM}\mathbin{\$}map_1 } no interpretador  irá obter a seguinte apresentação de um mapa:
\begin{tabbing}\ttfamily
~~\char95{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char95{}~~X~~\char95{}\\
\ttfamily ~~\char95{}~~X~~\char95{}
\end{tabbing}
Para facilitar o teste das implementações pedidas abaixo, disponibilizamos no anexo \ref{sec:codigo}
a função \ensuremath{\Varid{testWithRndMap}}. Por exemplo, ao correr
\ensuremath{\Varid{testWithRndMap}} obtivemos o seguinte mapa aleatoriamente:
\begin{tabbing}\ttfamily
~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~X\\
\ttfamily ~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X\\
\ttfamily ~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}~~X~~\char95{}\\
\ttfamily ~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char95{}~~X~~X~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}\\
\ttfamily ~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~X~~\char95{}\\
\ttfamily ~~\char95{}~~\char95{}~~X~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~\char95{}~~X\\
\ttfamily ~Map~of~dimension~10x10\char46{}
\end{tabbing}

De seguida, os valores \ensuremath{\Conid{Lft}}, \ensuremath{\Conid{Rght}},
\ensuremath{\Conid{Up}} e \ensuremath{\Conid{Down}} em \ensuremath{\Conid{Cell}} denotam o facto de uma célula ter sido alcançada
através da célula à esquerda, direita, de cima, ou de baixo, respectivamente.
Tais valores irão ser usados na representação de caminhos num mapa.

\begin{enumerate}
\setcounter{enumi}{1}
\item

Implemente agora a função \ensuremath{\Varid{markMap}\mathbin{::}[\mskip1.5mu \Conid{Pos}\mskip1.5mu]\to \Conid{Map}\to \Conid{Map}},
que dada uma lista de posições (representante de um \emph{caminho} de um ponto \emph{A} para
um ponto \emph{B}) e um mapa retorna um novo mapa com o caminho lá marcado.
Por exemplo, ao correr no interpretador,
\begin{center}
\ensuremath{\Varid{putStr}\mathbin{\$}\Varid{showM}\mathbin{\$}\Varid{markMap}\;[\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{0},\mathrm{2}),(\mathrm{1},\mathrm{2})\mskip1.5mu]\;map_1 }
\end{center}
deverá obter a seguinte apresentação de um mapa e respectivo caminho:
\begin{tabbing}\ttfamily
~~\char62{}~~\char95{}~~\char95{}\\
\ttfamily ~~\char94{}~~X~~\char95{}\\
\ttfamily ~~\char94{}~~X~~\char95{}
\end{tabbing}
representante do caso em que subimos duas vezes no mapa e depois viramos à direita.
Para implementar a função \ensuremath{\Varid{markMap}} deverá recorrer à função \ensuremath{\Varid{toCell}} (disponibilizada
no anexo \ref{sec:codigo}) e a uma função auxiliar com o tipo \ensuremath{[\mskip1.5mu (\Conid{Pos},\Conid{Pos})\mskip1.5mu]\to \Conid{Map}\to \Conid{Map}} definida como
um \emph{catamorfismo de listas}. Tal como anteriormente, anote as propriedades seguintes sobre
\ensuremath{\Varid{markMap}}:\footnote{Ao implementar a função \ensuremath{\Varid{markMap}}, estude também
a função \ensuremath{\Varid{subst}} (disponibilizada no anexo \ref{sec:codigo}) pois as duas funções tem
algumas semelhanças.}
\begin{itemize}\em
\item      Para qualquer lista \ensuremath{\Varid{l}} a função \ensuremath{\Varid{markMap}\;\Varid{l}} é idempotente.
\item      Todas as posições presentes na lista dada como argumento
irão fazer com que as células correspondentes no mapa deixem de ser \ensuremath{\Conid{Free}}.
\end{itemize}
\end{enumerate}

Finalmente há que implementar a função \ensuremath{\Varid{scout}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to \Conid{Pos}\to \Conid{Int}\to [\mskip1.5mu [\mskip1.5mu \Conid{Pos}\mskip1.5mu]\mskip1.5mu]},
que dado um mapa \ensuremath{\Varid{m}}, uma posição inicial \ensuremath{\Varid{s}}, uma posição alvo \ensuremath{\Varid{t}}, e um número
inteiro \ensuremath{\Varid{n}}, retorna uma lista de caminhos que começam em \ensuremath{\Varid{s}} e que têm tamanho máximo
\ensuremath{\Varid{n}\mathbin{+}\mathrm{1}}. Nenhum destes caminhos pode conter \ensuremath{\Varid{t}} como elemento que não seja o último na lista (i.e. um caminho deve terminar logo que se alcança a posição \ensuremath{\Varid{t}}). Para além disso,
não é permitido voltar a posições previamente visitadas e se ao alcançar uma posição
diferente de \ensuremath{\Varid{t}} é impossivel sair dela então todo o caminho que levou a esta
posição deve ser removido (\emph{backtracking}). Por exemplo: \\

\noindent
\ensuremath{\Varid{scout}\;map_1 \;(\mathrm{0},\mathrm{0})\;(\mathrm{2},\mathrm{0})\;\mathrm{0}\equiv [\mskip1.5mu [\mskip1.5mu (\mathrm{0},\mathrm{0})\mskip1.5mu]\mskip1.5mu]}

\noindent
\ensuremath{\Varid{scout}\;map_1 \;(\mathrm{0},\mathrm{0})\;(\mathrm{2},\mathrm{0})\;\mathrm{1}\equiv [\mskip1.5mu [\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1})\mskip1.5mu]\mskip1.5mu]}

\noindent
\ensuremath{\Varid{scout}\;map_1 \;(\mathrm{0},\mathrm{0})\;(\mathrm{2},\mathrm{0})\;\mathrm{4}\equiv [\mskip1.5mu [\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{0},\mathrm{2}),(\mathrm{1},\mathrm{2}),(\mathrm{2},\mathrm{2})\mskip1.5mu]\mskip1.5mu]}

\noindent
\ensuremath{\Varid{scout}\;map_2 \;(\mathrm{0},\mathrm{0})\;(\mathrm{2},\mathrm{2})\;\mathrm{2}\equiv [\mskip1.5mu [\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{1},\mathrm{1})\mskip1.5mu],[\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{0},\mathrm{2})\mskip1.5mu]\mskip1.5mu]}

\noindent
\ensuremath{\Varid{scout}\;map_2 \;(\mathrm{0},\mathrm{0})\;(\mathrm{2},\mathrm{2})\;\mathrm{4}\equiv [\mskip1.5mu [\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{1},\mathrm{1}),(\mathrm{2},\mathrm{1}),(\mathrm{2},\mathrm{2})\mskip1.5mu],[\mskip1.5mu (\mathrm{0},\mathrm{0}),(\mathrm{0},\mathrm{1}),(\mathrm{1},\mathrm{1}),(\mathrm{2},\mathrm{1}),(\mathrm{2},\mathrm{0})\mskip1.5mu]\mskip1.5mu]}

\begin{enumerate}
\setcounter{enumi}{2}
\item   Implemente a função
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{scout}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to \Conid{Pos}\to \Conid{Int}\to [\mskip1.5mu [\mskip1.5mu \Conid{Pos}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
recorrendo à função \ensuremath{\Varid{checkAround}} (disponibilizada no anexo \ref{sec:codigo}) e de tal forma a que
\ensuremath{\Varid{scout}\;\Varid{m}\;\Varid{s}\;\Varid{t}} seja um catamorfismos de naturais \emph{monádico}.
Anote a seguinte propriedade desta função:

\begin{itemize}\em
\item     \label{en:6a}
Quanto maior for o tamanho máximo permitido aos caminhos,  mais caminhos que alcançam a
posição alvo iremos encontrar.
\end{itemize}
\end{enumerate}

\newpage
\part*{Anexos}

\appendix

\section{Documentação para realizar o trabalho}
\label{sec:documentacao}
Para cumprir de forma integrada os objectivos Rdo trabalho vamos recorrer
a uma técnica de programa\-ção dita
``\litp{literária}'' \cite{Kn92}, cujo princípio base é o seguinte:
%
\begin{quote}\em Um programa e a sua documentação devem coincidir.
\end{quote}
%
Por outras palavras, o código fonte e a documentação de um
programa deverão estar no mesmo ficheiro.

O ficheiro \texttt{cp2122t.pdf} que está a ler é já um exemplo de
\litp{programação literária}: foi gerado a partir do texto fonte
\texttt{cp2122t.lhs}\footnote{O sufixo `lhs' quer dizer
\emph{\lhaskell{literate Haskell}}.} que encontrará no
\MaterialPedagogico\ desta disciplina descompactando o ficheiro
\texttt{cp2122t.zip} e executando:
\begin{Verbatim}[fontsize=\small]
    $ lhs2TeX cp2122t.lhs > cp2122t.tex
    $ pdflatex cp2122t
\end{Verbatim}
em que \href{https://hackage.haskell.org/package/lhs2tex}{\texttt\LhsToTeX} é
um pre-processador que faz ``pretty printing''
de código Haskell em \Latex\ e que deve desde já instalar executando
\begin{Verbatim}[fontsize=\small,commandchars=\\\{\}]
    $ cabal install lhs2tex --lib
    $ cabal install --ghc-option=-dynamic lhs2tex
\end{Verbatim}
\textbf{NB}: utilizadores do macOS poderão instalar o \ensuremath{\Varid{cabal}} com o seguinte comando:
\begin{Verbatim}[fontsize=\small,commandchars=\\\{\}]
    $ brew install cabal-install
\end{Verbatim}
Por outro lado, o mesmo ficheiro \texttt{cp2122t.lhs} é executável e contém
o ``kit'' básico, escrito em \Haskell, para realizar o trabalho. Basta executar
\begin{Verbatim}[fontsize=\small]
    $ ghci cp2122t.lhs
\end{Verbatim}

\noindent Abra o ficheiro \texttt{cp2122t.lhs} no seu editor de texto preferido
e verifique que assim é: todo o texto que se encontra dentro do ambiente
\begin{quote}\small\tt
\text{\ttfamily \char92{}begin\char123{}code\char125{}}
\\ ... \\
\text{\ttfamily \char92{}end\char123{}code\char125{}}
\end{quote}
é seleccionado pelo \GHCi\ para ser executado.

\subsection{Como realizar o trabalho}
Este trabalho teórico-prático deve ser realizado por grupos de 3 (ou 4) alunos.
Os detalhes da avaliação (datas para submissão do relatório e sua defesa
oral) são os que forem publicados na \cp{página da disciplina} na \emph{internet}.

Recomenda-se uma abordagem participativa dos membros do grupo
em todos os exercícios do trabalho, para assim
poderem responder a qualquer questão colocada na
\emph{defesa oral} do relatório.

Em que consiste, então, o \emph{relatório} a que se refere o parágrafo anterior?
É a edição do texto que está a ser lido, preenchendo o anexo \ref{sec:resolucao}
com as respostas. O relatório deverá conter ainda a identificação dos membros
do grupo de trabalho, no local respectivo da folha de rosto.

Para gerar o PDF integral do relatório deve-se ainda correr os comando seguintes,
que actualizam a bibliografia (com \Bibtex) e o índice remissivo (com \Makeindex),
\begin{Verbatim}[fontsize=\small]
    $ bibtex cp2122t.aux
    $ makeindex cp2122t.idx
\end{Verbatim}
e recompilar o texto como acima se indicou. Dever-se-á ainda instalar o utilitário
\QuickCheck,
que ajuda a validar programas em \Haskell:
\begin{Verbatim}[fontsize=\small,commandchars=\\\{\}]
    $ cabal install QuickCheck --lib
\end{Verbatim}
Para testar uma propriedade \QuickCheck~\ensuremath{\Varid{prop}}, basta invocá-la com o comando:
\begin{tabbing}\ttfamily
~~~~~\char62{}~quickCheck~prop\\
\ttfamily ~~~~~\char43{}\char43{}\char43{}~OK\char44{}~passed~100~tests\char46{}
\end{tabbing}
Pode-se ainda controlar o número de casos de teste e sua complexidade,
como o seguinte exemplo mostra:\footnote{
Como já sabe, os testes normalmente não provam a ausência
de erros no código, apenas a sua presença (\href{https://www.cs.utexas.edu/users/EWD/transcriptions/EWD03xx/EWD303.html}{cf. arquivo online}). Portanto não deve ver o facto
de o seu código passar nos testes abaixo como uma garantia que este está livre de erros.}
\begin{tabbing}\ttfamily
~~~~~\char62{}~quickCheckWith~stdArgs~\char123{}~maxSuccess~\char61{}~200\char44{}~maxSize~\char61{}~10~\char125{}~prop\\
\ttfamily ~~~~~\char43{}\char43{}\char43{}~OK\char44{}~passed~200~tests\char46{}
\end{tabbing}

Qualquer programador tem, na vida real, de ler e analisar (muito!) código
escrito por outros. No anexo \ref{sec:codigo} disponibiliza-se algum
código \Haskell\ relativo aos problemas que se seguem. Esse anexo deverá
ser consultado e analisado à medida que isso for necessário.

\paragraph{Stack}

O \stack{Stack} é um programa útil para criar, gerir e manter projetos em \Haskell.
Um projeto criado com o Stack possui uma estrutura de pastas muito específica:

\begin{itemize}
\item Os módulos auxiliares encontram-se na pasta \emph{src}.
\item O módulo principal encontra-se na pasta \emph{app}.
\item A lista de dependências externas encontra-se no ficheiro \emph{package.yaml}.
\end{itemize}

\noindent Pode aceder ao \GHCi\ utilizando o comando:
\begin{tabbing}\ttfamily
~stack~ghci
\end{tabbing}

\noindent Garanta que se encontra na pasta mais externa \textbf{do projeto}.
A primeira vez que correr este comando as depêndencias externas serão instaladas automaticamente. Para gerar o PDF, garanta que se encontra na diretoria \emph{app}.

\subsection{Como exprimir cálculos e diagramas em LaTeX/lhs2tex}
Como primeiro exemplo, estudar o texto fonte deste trabalho para obter o
efeito:\footnote{Exemplos tirados de \cite{Ol18}.}
\begin{eqnarray*}
\start
     \ensuremath{\Varid{id}\mathrel{=}\conj{\Varid{f}}{\Varid{g}}}
%
\just\equiv{ universal property }
%
        \ensuremath{\begin{lcbr}\p1\comp \Varid{id}\mathrel{=}\Varid{f}\\\p2\comp \Varid{id}\mathrel{=}\Varid{g}\end{lcbr}}
%
\just\equiv{ identity }
%
        \ensuremath{\begin{lcbr}\p1\mathrel{=}\Varid{f}\\\p2\mathrel{=}\Varid{g}\end{lcbr}}
\qed
\end{eqnarray*}

Os diagramas podem ser produzidos recorrendo à \emph{package} \LaTeX\
\href{https://ctan.org/pkg/xymatrix}{xymatrix}, por exemplo:
\begin{eqnarray*}
\xymatrix@C=2cm{
    \ensuremath{\N_0}
           \ar[d]_-{\ensuremath{\cataNat{\Varid{g}}}}
&
    \ensuremath{\mathrm{1}\mathbin{+}\N_0}
           \ar[d]^{\ensuremath{\Varid{id}\mathbin{+}\cataNat{\Varid{g}}}}
           \ar[l]_-{\ensuremath{\mathsf{in}}}
\\
     \ensuremath{\Conid{B}}
&
     \ensuremath{\mathrm{1}\mathbin{+}\Conid{B}}
           \ar[l]^-{\ensuremath{\Varid{g}}}
}
\end{eqnarray*}

\section{Código fornecido}\label{sec:codigo}

\subsection*{Problema 1}

Sequência de transações para teste:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{9}{@{}>{\hspre}l<{\hspost}@{}}%
\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
\column{26}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{trs}\mathrel{=}[\mskip1.5mu (\text{\ttfamily \char34 compra\char34},{}\<[21]%
\>[21]{}\text{\ttfamily \char34 20211102\char34},\mathbin{-}\mathrm{50}),{}\<[E]%
\\
\>[B]{}\hsindent{9}{}\<[9]%
\>[9]{}(\text{\ttfamily \char34 venda\char34},{}\<[21]%
\>[21]{}\text{\ttfamily \char34 20211103\char34},\mathrm{100}),{}\<[E]%
\\
\>[B]{}\hsindent{9}{}\<[9]%
\>[9]{}(\text{\ttfamily \char34 despesa\char34},\text{\ttfamily \char34 20212103\char34},\mathbin{-}\mathrm{20}),{}\<[E]%
\\
\>[B]{}\hsindent{9}{}\<[9]%
\>[9]{}(\text{\ttfamily \char34 venda\char34},{}\<[21]%
\>[21]{}\text{\ttfamily \char34 20211205\char34},\mathrm{250}),{}\<[E]%
\\
\>[B]{}\hsindent{9}{}\<[9]%
\>[9]{}(\text{\ttfamily \char34 venda\char34},{}\<[21]%
\>[21]{}\text{\ttfamily \char34 20211205\char34},\mathrm{120})\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{trsmoded}\mathrel{=}[\mskip1.5mu (\text{\ttfamily \char34 compra\char34},{}\<[26]%
\>[26]{}\text{\ttfamily \char34 20211102\char34},\mathbin{-}\mathrm{50}),{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}(\text{\ttfamily \char34 venda\char34},{}\<[26]%
\>[26]{}\text{\ttfamily \char34 20211103\char34},\mathrm{100}),{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}(\text{\ttfamily \char34 despesa\char34},\text{\ttfamily \char34 20212103\char34},\mathbin{-}\mathrm{20}),{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}(\text{\ttfamily \char34 venda\char34},{}\<[26]%
\>[26]{}\text{\ttfamily \char34 20211205\char34},\mathrm{250}),{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}(\text{\ttfamily \char34 venda\char34},{}\<[26]%
\>[26]{}\text{\ttfamily \char34 20211206\char34},\mathrm{120})\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{getEvenBlock}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{getEvenBlock}\;\Varid{l}\mathrel{=}\mathbf{if}\;(\Varid{even}\;(\length \;\Varid{l}))\;\mathbf{then}\;\Varid{l}\;\mathbf{else}\;\Varid{l}\mathbin{+\!\!\!+}[\mskip1.5mu \Varid{last}\;\Varid{l}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{firsts}\mathrel{=}\alt{\p1}{\p1}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\subsection*{Problema 2}

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{wc\char95 test}\mathrel{=}\text{\ttfamily \char34 Here~is~a~sentence,~for~testing.\char92 nA~short~one.\char34}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{sp}\;\Varid{c}\mathrel{=}(\Varid{c}\equiv \text{\ttfamily '~'}\mathrel{\vee}\Varid{c}\equiv \text{\ttfamily '\char92 n'}\mathrel{\vee}\Varid{c}\equiv \text{\ttfamily '\char92 t'}){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\subsection*{Problema 3}\label{sec:C}
Tipos:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{X}\;\Varid{u}\;\Varid{i}\mathrel{=}\Conid{XLeaf}\;\Varid{u}\mid \Conid{Node}\;\Varid{i}\;(\Conid{X}\;\Varid{u}\;\Varid{i})\;(\Conid{X}\;\Varid{u}\;\Varid{i})\;\mathbf{deriving}\;\Conid{Show}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{data}\;\Conid{Frame}\;\Varid{i}\mathrel{=}\Conid{Frame}\;\Varid{i}\;\Varid{i}\;\mathbf{deriving}\;\Conid{Show}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Funções da API\footnote{
API (=``Application Program Interface'').
}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{printJournal}\mathbin{::}\Conid{Sheet}\;\Conid{String}\;\Conid{String}\;\Conid{Double}\to \fun{IO}\;(){}\<[E]%
\\
\>[B]{}\Varid{printJournal}\mathrel{=}\Varid{write}\comp \Varid{sheet2html}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{write}\mathbin{::}\Conid{String}{}\<[18]%
\>[18]{}\to \fun{IO}\;(){}\<[E]%
\\
\>[B]{}\Varid{write}\;\Varid{s}\mathrel{=}\mathbf{do}\;\Varid{writeFile}\;\text{\ttfamily \char34 jornal.html\char34}\;\Varid{s}{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}\Varid{putStrLn}\;\text{\ttfamily \char34 Output~HTML~written~into~file~`jornal.html'\char34}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Geração de HTML: \label{sec:html}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{36}{@{}>{\hspre}c<{\hspost}@{}}%
\column{36E}{@{}l@{}}%
\column{38}{@{}>{\hspre}l<{\hspost}@{}}%
\column{42}{@{}>{\hspre}l<{\hspost}@{}}%
\column{57}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{sheet2html}\;(\Conid{Rect}\;(\Conid{Frame}\;\Varid{w}\;\Varid{h})\;\Varid{y})\mathrel{=}\Varid{htmlwrap}\;(\Varid{x2html}\;\Varid{y}\;(\Varid{w},\Varid{h})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{x2html}\mathbin{::}\Conid{X}\;(\Conid{Unit}\;\Conid{String}\;\Conid{String})\;(\Conid{Mode}\;\Conid{Double})\to (\Conid{Double},\Conid{Double})\to \Conid{String}{}\<[E]%
\\
\>[B]{}\Varid{x2html}\;(\Conid{XLeaf}\;(\Conid{Image}\;\Varid{i}))\;(\Varid{w},\Varid{h})\mathrel{=}\Varid{img}\;\Varid{w}\;\Varid{h}\;\Varid{i}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{x2html}\;(\Conid{XLeaf}\;(\Conid{Text}\;\Varid{txt}))\;\anonymous \mathrel{=}\Varid{txt}{}\<[E]%
\\
\>[B]{}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Vt}\;\Varid{i})\;\Varid{x1}\;\Varid{x2})\;(\Varid{w},\Varid{h})\mathrel{=}\Varid{htab}\;\Varid{w}\;\Varid{h}\;({}\<[E]%
\\
\>[B]{}\hsindent{38}{}\<[38]%
\>[38]{}\Varid{tr}\;(\Varid{td}\;\Varid{w}\;(\Varid{h}\mathbin{*}\Varid{i})\;{}\<[57]%
\>[57]{}(\Varid{x2html}\;\Varid{x1}\;(\Varid{w},\Varid{h}\mathbin{*}\Varid{i})))\mathbin{+\!\!\!+}{}\<[E]%
\\
\>[B]{}\hsindent{38}{}\<[38]%
\>[38]{}\Varid{tr}\;(\Varid{td}\;\Varid{w}\;(\Varid{h}\mathbin{*}(\mathrm{1}\mathbin{-}\Varid{i}))\;(\Varid{x2html}\;\Varid{x2}\;(\Varid{w},\Varid{h}\mathbin{*}(\mathrm{1}\mathbin{-}\Varid{i})))){}\<[E]%
\\
\>[B]{}\hsindent{36}{}\<[36]%
\>[36]{}){}\<[36E]%
\\
\>[B]{}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Hl}\;\Varid{i})\;\Varid{x1}\;\Varid{x2})\;(\Varid{w},\Varid{h})\mathrel{=}\Varid{htab}\;\Varid{w}\;\Varid{h}\;({}\<[E]%
\\
\>[B]{}\hsindent{38}{}\<[38]%
\>[38]{}\Varid{tr}\;(\Varid{td}\;(\Varid{w}\mathbin{*}\Varid{i})\;\Varid{h}\;{}\<[57]%
\>[57]{}(\Varid{x2html}\;\Varid{x1}\;(\Varid{w}\mathbin{*}\Varid{i},\Varid{h}))\mathbin{+\!\!\!+}{}\<[E]%
\\
\>[38]{}\hsindent{4}{}\<[42]%
\>[42]{}\Varid{td}\;(\Varid{w}\mathbin{*}(\mathrm{1}\mathbin{-}\Varid{i}))\;\Varid{h}\;(\Varid{x2html}\;\Varid{x2}\;(\Varid{w}\mathbin{*}(\mathrm{1}\mathbin{-}\Varid{i}),\Varid{h}))){}\<[E]%
\\
\>[B]{}\hsindent{36}{}\<[36]%
\>[36]{}){}\<[36E]%
\\[\blanklineskip]%
\>[B]{}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Vb}\;\Varid{i})\;\Varid{x1}\;\Varid{x2})\;\Varid{m}\mathrel{=}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Vt}\;(\mathrm{1}\mathbin{-}\Varid{i}))\;\Varid{x1}\;\Varid{x2})\;\Varid{m}{}\<[E]%
\\
\>[B]{}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Hr}\;\Varid{i})\;\Varid{x1}\;\Varid{x2})\;\Varid{m}\mathrel{=}\Varid{x2html}\;(\Conid{Node}\;(\Conid{Hl}\;(\mathrm{1}\mathbin{-}\Varid{i}))\;\Varid{x1}\;\Varid{x2})\;\Varid{m}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Funções auxiliares: \label{sec:faux}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{9}{@{}>{\hspre}l<{\hspost}@{}}%
\column{11}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{twoVtImg}\;\Varid{a}\;\Varid{b}\mathrel{=}\Conid{Node}\;(\Conid{Vt}\;\mathrm{0.5})\;(\Conid{XLeaf}\;(\Conid{Image}\;\Varid{a}))\;(\Conid{XLeaf}\;(\Conid{Image}\;\Varid{b})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{fourInArow}\;\Varid{a}\;\Varid{b}\;\Varid{c}\;\Varid{d}\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{9}{}\<[9]%
\>[9]{}\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.5})\;{}\<[E]%
\\
\>[9]{}\hsindent{2}{}\<[11]%
\>[11]{}(\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.5})\;(\Conid{XLeaf}\;(\Conid{Text}\;\Varid{a}))\;(\Conid{XLeaf}\;(\Conid{Text}\;\Varid{b})))\;{}\<[E]%
\\
\>[9]{}\hsindent{2}{}\<[11]%
\>[11]{}(\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.5})\;(\Conid{XLeaf}\;(\Conid{Text}\;\Varid{c}))\;(\Conid{XLeaf}\;(\Conid{Text}\;\Varid{d}))){}\<[E]%
\ColumnHook
\end{hscode}\resethooks
HTML:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{htmlwrap}\mathrel{=}\Varid{html}\comp \Varid{hd}\comp (\Varid{title}\;\text{\ttfamily \char34 CP/2122~-~sheet2html\char34})\comp \Varid{body}\comp \Varid{divt}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{html}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 html\char34}\;[\mskip1.5mu \mskip1.5mu]\comp (\text{\ttfamily \char34 <meta~charset=\char92 \char34 utf-8\char92 \char34 ~/>\char34}\mathbin{+\!\!\!+}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{title}\;\Varid{t}\mathrel{=}(\Varid{tag}\;\text{\ttfamily \char34 title\char34}\;[\mskip1.5mu \mskip1.5mu]\;\Varid{t}\mathbin{+\!\!\!+}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{body}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 body\char34}\;[\mskip1.5mu \text{\ttfamily \char34 BGCOLOR\char34}\mapsto\Varid{show}\;\text{\ttfamily \char34 \#F4EFD8\char34}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{hd}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 head\char34}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{htab}\;\Varid{w}\;\Varid{h}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 table\char34}\;[\mskip1.5mu {}\<[E]%
\\
\>[B]{}\hsindent{19}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 width\char34}\mapsto\Varid{show2}\;\Varid{w},\text{\ttfamily \char34 height\char34}\mapsto\Varid{show2}\;\Varid{h},{}\<[E]%
\\
\>[B]{}\hsindent{19}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 cellpadding\char34}\mapsto\Varid{show2}\;\mathrm{0},\text{\ttfamily \char34 border\char34}\mapsto\Varid{show}\;\text{\ttfamily \char34 1px\char34}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{tr}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 tr\char34}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{td}\;\Varid{w}\;\Varid{h}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 td\char34}\;[\mskip1.5mu \text{\ttfamily \char34 width\char34}\mapsto\Varid{show2}\;\Varid{w},\text{\ttfamily \char34 height\char34}\mapsto\Varid{show2}\;\Varid{h}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{divt}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 div\char34}\;[\mskip1.5mu \text{\ttfamily \char34 align\char34}\mapsto\Varid{show}\;\text{\ttfamily \char34 center\char34}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{img}\;\Varid{w}\;\Varid{h}\;\Varid{i}\mathrel{=}\Varid{tag}\;\text{\ttfamily \char34 img\char34}\;[\mskip1.5mu \text{\ttfamily \char34 width\char34}\mapsto\Varid{show2}\;\Varid{w},\text{\ttfamily \char34 src\char34}\mapsto\Varid{show}\;\Varid{i}\mskip1.5mu]\;\text{\ttfamily \char34 \char34}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{tag}\;\Varid{t}\;\Varid{l}\;\Varid{x}\mathrel{=}\text{\ttfamily \char34 <\char34}\mathbin{+\!\!\!+}\Varid{t}\mathbin{+\!\!\!+}\text{\ttfamily \char34 ~\char34}\mathbin{+\!\!\!+}\Varid{ps}\mathbin{+\!\!\!+}\text{\ttfamily \char34 >\char34}\mathbin{+\!\!\!+}\Varid{x}\mathbin{+\!\!\!+}\text{\ttfamily \char34 </\char34}\mathbin{+\!\!\!+}\Varid{t}\mathbin{+\!\!\!+}\text{\ttfamily \char34 >\char92 n\char34}{}\<[E]%
\\
\>[B]{}\hsindent{14}{}\<[14]%
\>[14]{}\mathbf{where}\;\Varid{ps}\mathrel{=}\Varid{unwords}\;[\mskip1.5mu \Varid{concat}\;[\mskip1.5mu \Varid{t},\text{\ttfamily \char34 =\char34},\Varid{v}\mskip1.5mu]\mid (\Varid{t},\Varid{v})\leftarrow \Varid{l}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{a}\mapsto\Varid{b}\mathrel{=}(\Varid{a},\Varid{b}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{show2}\mathbin{::}\Conid{Show}\;\Varid{a}\Rightarrow \Varid{a}\to \Conid{String}{}\<[E]%
\\
\>[B]{}\Varid{show2}\mathrel{=}\Varid{show}\comp \Varid{show}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Exemplo para teste: \label{sec:test_data}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{4}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{10}{@{}>{\hspre}l<{\hspost}@{}}%
\column{11}{@{}>{\hspre}l<{\hspost}@{}}%
\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{example}\mathbin{::}(\Conid{Fractional}\;\Varid{i})\Rightarrow \Conid{Sheet}\;\Conid{String}\;\Conid{String}\;\Varid{i}{}\<[E]%
\\
\>[B]{}\Varid{example}\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\Conid{Rect}\;(\Conid{Frame}\;\mathrm{650}\;\mathrm{450})\;{}\<[E]%
\\
\>[4]{}\hsindent{1}{}\<[5]%
\>[5]{}(\Conid{Node}\;(\Conid{Vt}\;\mathrm{0.01})\;{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}(\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.15})\;{}\<[E]%
\\
\>[7]{}\hsindent{3}{}\<[10]%
\>[10]{}(\Conid{XLeaf}\;(\Conid{Image}\;\text{\ttfamily \char34 cp2122t\char95 media/publico.jpg\char34}))\;{}\<[E]%
\\
\>[7]{}\hsindent{3}{}\<[10]%
\>[10]{}(\Varid{fourInArow}\;\text{\ttfamily \char34 Jornal~Público\char34}\;\text{\ttfamily \char34 Domingo,~5~de~Dezembro~2021\char34}\;\text{\ttfamily \char34 Simulação~para~efeitos~escolares\char34}\;\text{\ttfamily \char34 CP/2122-TP\char34}))\;{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}(\Conid{Node}\;(\Conid{Vt}\;\mathrm{0.55})\;{}\<[E]%
\\
\>[7]{}\hsindent{4}{}\<[11]%
\>[11]{}(\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.55})\;{}\<[E]%
\\
\>[11]{}\hsindent{4}{}\<[15]%
\>[15]{}(\Conid{Node}\;(\Conid{Vt}\;\mathrm{0.1})\;{}\<[E]%
\\
\>[15]{}\hsindent{3}{}\<[18]%
\>[18]{}(\Conid{XLeaf}\;(\Conid{Text}{}\<[E]%
\\
\>[15]{}\hsindent{3}{}\<[18]%
\>[18]{}\text{\ttfamily \char34 Universidade~do~Algarve~estuda~planta~capaz~de~eliminar~a~doença~do~sobreiro\char34}))\;{}\<[E]%
\\
\>[15]{}\hsindent{3}{}\<[18]%
\>[18]{}(\Conid{XLeaf}\;(\Conid{Text}{}\<[E]%
\\
\>[18]{}\hsindent{1}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 Organismo~(semelhante~a~um~fungo)~ataca~de~forma~galopante~os~montados~de~sobro.~O~contra-poder~para~fazer~recuar~o~agente~destruidor~reside~numa~planta~(marioila),~que~nasce~espontânea~no~Algarve~e~Alentejo.\char92 nComo~travar~o~declínio~do~sobreiro?~A~árvore,~classificada~como~Património~Nacional~de~Portugal~desde~Dezembro~de~2011,~continua~numa~lenta~agonia.~O~processo~destrutivo~-~ainda~sem~fim~à~vista~à~vista~-~pode~agora~ser~estancado.~(...)\char34})))\;{}\<[E]%
\\
\>[11]{}\hsindent{4}{}\<[15]%
\>[15]{}(\Conid{XLeaf}\;(\Conid{Image}{}\<[E]%
\\
\>[15]{}\hsindent{4}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 cp2122t\char95 media/1647472.jpg\char34})))\;{}\<[E]%
\\
\>[7]{}\hsindent{4}{}\<[11]%
\>[11]{}(\Conid{Node}\;(\Conid{Hl}\;\mathrm{0.25})\;{}\<[E]%
\\
\>[11]{}\hsindent{4}{}\<[15]%
\>[15]{}(\Varid{twoVtImg}\;{}\<[E]%
\\
\>[15]{}\hsindent{4}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 cp2122t\char95 media/1647981.jpg\char34}\;{}\<[E]%
\\
\>[15]{}\hsindent{4}{}\<[19]%
\>[19]{}\text{\ttfamily \char34 cp2122t\char95 media/1647982.jpg\char34})\;{}\<[E]%
\\
\>[11]{}\hsindent{4}{}\<[15]%
\>[15]{}(\Conid{Node}\;(\Conid{Vt}\;\mathrm{0.1})\;{}\<[E]%
\\
\>[15]{}\hsindent{4}{}\<[19]%
\>[19]{}(\Conid{XLeaf}\;(\Conid{Text}\;\text{\ttfamily \char34 Manchester~United~vence~na~estreia~de~Rangnick\char34}))\;{}\<[E]%
\\
\>[15]{}\hsindent{4}{}\<[19]%
\>[19]{}(\Conid{XLeaf}\;(\Conid{Text}\;\text{\ttfamily \char34 O~Manchester~United~venceu,~este~domingo,~em~Old~Trafford,~na~estreia~do~treinador~alemão~Ralf~Rangnick,~impondo-se~por~1-0~frente~ao~Crystal~Palace~de~Patrick~Vieira~graças~a~um~golo~do~brasileiro~Fred,~já~no~último~quarto~de~hora~da~partida~da~15.ª~ronda~da~Liga~inglesa.~(...)\char34})))))){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\subsection*{Problema 4}\label{sec:D}
Exemplos de mapas:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}map_1 \mathrel{=}[\mskip1.5mu [\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Free},\Conid{Free}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\\
\>[B]{}map_2 \mathrel{=}[\mskip1.5mu [\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Free},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\\
\>[B]{}map_3\mathrel{=}[\mskip1.5mu [\mskip1.5mu \Conid{Free},\Conid{Free},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu],[\mskip1.5mu \Conid{Free},\Conid{Blocked},\Conid{Free}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Código para impressões de mapas e caminhos:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{showM}\mathbin{::}\Conid{Map}\to \Conid{String}{}\<[E]%
\\
\>[B]{}\Varid{showM}\mathrel{=}\Varid{unlines}\comp (\map \;\Varid{showL})\comp \Varid{reverse}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{showL}{}\<[8]%
\>[8]{}\mathbin{::}[\mskip1.5mu \Conid{Cell}\mskip1.5mu]\to \Conid{String}{}\<[E]%
\\
\>[B]{}\Varid{showL}\mathrel{=}\cataList{\alt{f_1 }{f_2 }}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_1 \mathrel{=}\underline{\text{\ttfamily \char34 \char34}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \mathrel{=}\uncurry{(\mathbin{+\!\!\!+})}\comp (\Varid{fromCell}\times\Varid{id}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{fromCell}\;\Conid{Lft}\mathrel{=}\text{\ttfamily \char34 ~>~\char34}{}\<[E]%
\\
\>[B]{}\Varid{fromCell}\;\Conid{Rght}\mathrel{=}\text{\ttfamily \char34 ~<~\char34}{}\<[E]%
\\
\>[B]{}\Varid{fromCell}\;\Conid{Up}\mathrel{=}\text{\ttfamily \char34 ~\char94 ~\char34}{}\<[E]%
\\
\>[B]{}\Varid{fromCell}\;\Conid{Down}\mathrel{=}\text{\ttfamily \char34 ~v~\char34}{}\<[E]%
\\
\>[B]{}\Varid{fromCell}\;\Conid{Free}\mathrel{=}\text{\ttfamily \char34 ~\char95 ~\char34}{}\<[E]%
\\
\>[B]{}\Varid{fromCell}\;\Conid{Blocked}\mathrel{=}\text{\ttfamily \char34 ~X~\char34}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{toCell}\;(\Varid{x},\Varid{y})\;(\Varid{w},\Varid{z})\mid \Varid{x}\mathbin{<}\Varid{w}\mathrel{=}\Conid{Lft}{}\<[E]%
\\
\>[B]{}\Varid{toCell}\;(\Varid{x},\Varid{y})\;(\Varid{w},\Varid{z})\mid \Varid{x}\mathbin{>}\Varid{w}\mathrel{=}\Conid{Rght}{}\<[E]%
\\
\>[B]{}\Varid{toCell}\;(\Varid{x},\Varid{y})\;(\Varid{w},\Varid{z})\mid \Varid{y}\mathbin{<}\Varid{z}\mathrel{=}\Conid{Up}{}\<[E]%
\\
\>[B]{}\Varid{toCell}\;(\Varid{x},\Varid{y})\;(\Varid{w},\Varid{z})\mid \Varid{y}\mathbin{>}\Varid{z}\mathrel{=}\Conid{Down}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\noindent
Código para validação de mapas (útil, por exemplo, para testes
\QuickCheck):
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{ncols}\mathbin{::}\Conid{Map}\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{ncols}\mathrel{=}\alt{\underline{\mathrm{0}}}{\length \comp \p1}\comp \Varid{outList}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{nlines}\mathbin{::}\Conid{Map}\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{nlines}\mathrel{=}\length {}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{isValidMap}\mathbin{::}\Conid{Map}\to \Conid{Bool}{}\<[E]%
\\
\>[B]{}\Varid{isValidMap}\mathrel{=}\uncurry{(\mathrel{\wedge})}\comp \conj{\Varid{isSquare}}{\Varid{sameLength}}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{isSquare}\mathrel{=}\uncurry{(\equiv )}\comp \conj{\Varid{nlines}}{\Varid{ncols}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{sameLength}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\Conid{True}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{sameLength}\;[\mskip1.5mu \Varid{x}\mskip1.5mu]\mathrel{=}\Conid{True}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{sameLength}\;(\Varid{x1}\mathbin{:}\Varid{x2}\mathbin{:}\Varid{y})\mathrel{=}\length \;\Varid{x1}\equiv \length \;\Varid{x2}\mathrel{\wedge}\Varid{sameLength}\;(\Varid{x2}\mathbin{:}\Varid{y}){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\noindent
Código para geração aleatória de mapas e automatização de testes
(envolve o mónade IO):
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{13}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{randomRIOL}\mathbin{::}(\Conid{Random}\;\Varid{a})\Rightarrow (\Varid{a},\Varid{a})\to \Conid{Int}\to \fun{IO}\;[\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{randomRIOL}\;\Varid{x}\mathrel{=}\cataNat{\alt{f_1 }{f_2 }}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_1 \mathrel{=}\underline{\Varid{return}\;[\mskip1.5mu \mskip1.5mu]}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \;\Varid{l}\mathrel{=}\mathbf{do}\;\Varid{r1}\leftarrow \Varid{randomRIO}\;\Varid{x}{}\<[E]%
\\
\>[3]{}\hsindent{10}{}\<[13]%
\>[13]{}\Varid{r2}\leftarrow \Varid{l}{}\<[E]%
\\
\>[3]{}\hsindent{10}{}\<[13]%
\>[13]{}\Varid{return}\mathbin{\$}\Varid{r1}\mathbin{:}\Varid{r2}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{buildMat}\mathbin{::}\Conid{Int}\to \Conid{Int}\to \fun{IO}\;[\mskip1.5mu [\mskip1.5mu \Conid{Int}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{buildMat}\;\Varid{n}\mathrel{=}\cataNat{\alt{f_1 }{f_2 }}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_1 \mathrel{=}\underline{\Varid{return}\;[\mskip1.5mu \mskip1.5mu]}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \;\Varid{l}\mathrel{=}\mathbf{do}\;\Varid{x}\leftarrow \Varid{randomRIOL}\;(\mathrm{0}\mathbin{::}\Conid{Int},\mathrm{3}\mathbin{::}\Conid{Int})\;\Varid{n}{}\<[E]%
\\
\>[3]{}\hsindent{10}{}\<[13]%
\>[13]{}\Varid{y}\leftarrow \Varid{l}{}\<[E]%
\\
\>[3]{}\hsindent{10}{}\<[13]%
\>[13]{}\Varid{return}\mathbin{\$}\Varid{x}\mathbin{:}\Varid{y}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{testWithRndMap}\mathbin{::}\fun{IO}\;(){}\<[E]%
\\
\>[B]{}\Varid{testWithRndMap}\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{dim}\leftarrow \Varid{randomRIO}\;(\mathrm{2},\mathrm{10})\mathbin{::}\fun{IO}\;\Conid{Int}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{out}\leftarrow \Varid{buildMat}\;\Varid{dim}\;\Varid{dim}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\map \leftarrow \Varid{return}\mathbin{\$}\map \;(\map \;\Varid{table})\;\Varid{out}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{putStr}\mathbin{\$}\Varid{showM}\;\map {}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{putStrLn}\mathbin{\$}\text{\ttfamily \char34 Map~of~dimension~\char34}\mathbin{+\!\!\!+}(\Varid{show}\;\Varid{dim})\mathbin{+\!\!\!+}\text{\ttfamily \char34 x\char34}\mathbin{+\!\!\!+}(\Varid{show}\;\Varid{dim})\mathbin{+\!\!\!+}\text{\ttfamily \char34 .\char34}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{putStr}\;\text{\ttfamily \char34 Please~provide~a~target~position~(must~be~different~from~(0,0)):~\char34}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{t}\leftarrow \Varid{readLn}\mathbin{::}\fun{IO}\;(\Conid{Int},\Conid{Int}){}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{putStr}\;\text{\ttfamily \char34 Please~provide~the~number~of~steps~to~compute:~\char34}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\Varid{n}\leftarrow \Varid{readLn}\mathbin{::}\fun{IO}\;\Conid{Int}{}\<[E]%
\\
\>[B]{}\hsindent{5}{}\<[5]%
\>[5]{}\mathbf{let}\;\Varid{paths}\mathrel{=}\Varid{hasTarget}\;\Varid{t}\;(\Varid{scout}\;\map \;(\mathrm{0},\mathrm{0})\;\Varid{t}\;\Varid{n})\;\mathbf{in}{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}\mathbf{if}\;\length \;\Varid{paths}\equiv \mathrm{0}{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}\mathbf{then}\;\Varid{putStrLn}\;\text{\ttfamily \char34 No~paths~found.\char34}{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}\mathbf{else}\;\Varid{putStrLn}\mathbin{\$}\text{\ttfamily \char34 There~are~at~least~\char34}\mathbin{+\!\!\!+}(\Varid{show}\mathbin{\$}\length \;\Varid{paths})\mathbin{+\!\!\!+}{}\<[E]%
\\
\>[5]{}\hsindent{2}{}\<[7]%
\>[7]{}\text{\ttfamily \char34 ~possible~paths.~Here~is~one~case:~\char92 n\char34}\mathbin{+\!\!\!+}(\Varid{showM}\mathbin{\$}\Varid{markMap}\;(\Varid{head}\;\Varid{paths})\;\map ){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{table}\;\mathrm{0}\mathrel{=}\Conid{Free}{}\<[E]%
\\
\>[B]{}\Varid{table}\;\mathrm{1}\mathrel{=}\Conid{Free}{}\<[E]%
\\
\>[B]{}\Varid{table}\;\mathrm{2}\mathrel{=}\Conid{Free}{}\<[E]%
\\
\>[B]{}\Varid{table}\;\mathrm{3}\mathrel{=}\Conid{Blocked}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{hasTarget}\;\Varid{y}\mathrel{=}\Varid{filter}\;(\lambda \Varid{l}\to \Varid{elem}\;\Varid{y}\;\Varid{l}){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\paragraph{Funções auxiliares}
\ensuremath{\Varid{subst}\mathbin{::}\Varid{a}\to \Conid{Int}\to [\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]}, que dado um valor \ensuremath{\Varid{x}} e um inteiro \ensuremath{\Varid{n}},
produz uma função \ensuremath{\Varid{f}\mathbin{:}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]} que dada uma lista \ensuremath{\Varid{l}} substitui o valor na posição
\ensuremath{\Varid{n}} dessa lista pelo valor \ensuremath{\Varid{x}}:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{subst}\mathbin{::}\Varid{a}\to \Conid{Int}\to [\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{subst}\;\Varid{x}\mathrel{=}\cataNat{\alt{f_1 }{f_2 }}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_1 \mathrel{=}\underline{\lambda \Varid{l}\to \Varid{x}\mathbin{:}\Varid{tail}\;\Varid{l}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \;\Varid{f}\;(\Varid{h}\mathbin{:}\Varid{t})\mathrel{=}\Varid{h}\mathbin{:}\Varid{f}\;\Varid{t}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\ensuremath{\Varid{checkAround}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]}, que
verifica se as células adjacentes estão livres:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
\column{22}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{type}\;\Conid{Pos}\mathrel{=}(\Conid{Int},\Conid{Int}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{checkAround}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{checkAround}\;\Varid{m}\;\Varid{p}\mathrel{=}\Varid{concat}\mathbin{\$}\map \;(\lambda \Varid{f}\to \Varid{f}\;\Varid{m}\;\Varid{p}){}\<[E]%
\\
\>[B]{}\hsindent{19}{}\<[19]%
\>[19]{}[\mskip1.5mu \Varid{checkLeft},\Varid{checkRight},\Varid{checkUp},\Varid{checkDown}\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{checkLeft}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{checkLeft}\;\Varid{m}\;(\Varid{x},\Varid{y})\mathrel{=}\mathbf{if}\;\Varid{x}\equiv \mathrm{0}\mathrel{\vee}(\Varid{m}\mathbin{!!}\Varid{y})\mathbin{!!}(\Varid{x}\mathbin{-}\mathrm{1})\equiv \Conid{Blocked}{}\<[E]%
\\
\>[B]{}\hsindent{21}{}\<[21]%
\>[21]{}\mathbf{then}\;[\mskip1.5mu \mskip1.5mu]\;\mathbf{else}\;[\mskip1.5mu (\Varid{x}\mathbin{-}\mathrm{1},\Varid{y})\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{checkRight}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{checkRight}\;\Varid{m}\;(\Varid{x},\Varid{y})\mathrel{=}\mathbf{if}\;\Varid{x}\equiv (\Varid{ncols}\;\Varid{m}\mathbin{-}\mathrm{1})\mathrel{\vee}(\Varid{m}\mathbin{!!}\Varid{y})\mathbin{!!}(\Varid{x}\mathbin{+}\mathrm{1})\equiv \Conid{Blocked}{}\<[E]%
\\
\>[B]{}\hsindent{22}{}\<[22]%
\>[22]{}\mathbf{then}\;[\mskip1.5mu \mskip1.5mu]\;\mathbf{else}\;[\mskip1.5mu (\Varid{x}\mathbin{+}\mathrm{1},\Varid{y})\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{checkUp}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{checkUp}\;\Varid{m}\;(\Varid{x},\Varid{y})\mathrel{=}\mathbf{if}\;\Varid{y}\equiv (\Varid{nlines}\;\Varid{m}\mathbin{-}\mathrm{1})\mathrel{\vee}(\Varid{m}\mathbin{!!}(\Varid{y}\mathbin{+}\mathrm{1}))\mathbin{!!}\Varid{x}\equiv \Conid{Blocked}{}\<[E]%
\\
\>[B]{}\hsindent{19}{}\<[19]%
\>[19]{}\mathbf{then}\;[\mskip1.5mu \mskip1.5mu]\;\mathbf{else}\;[\mskip1.5mu (\Varid{x},\Varid{y}\mathbin{+}\mathrm{1})\mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{checkDown}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to [\mskip1.5mu \Conid{Pos}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{checkDown}\;\Varid{m}\;(\Varid{x},\Varid{y})\mathrel{=}\mathbf{if}\;\Varid{y}\equiv \mathrm{0}\mathrel{\vee}(\Varid{m}\mathbin{!!}(\Varid{y}\mathbin{-}\mathrm{1}))\mathbin{!!}\Varid{x}\equiv \Conid{Blocked}{}\<[E]%
\\
\>[B]{}\hsindent{21}{}\<[21]%
\>[21]{}\mathbf{then}\;[\mskip1.5mu \mskip1.5mu]\;\mathbf{else}\;[\mskip1.5mu (\Varid{x},\Varid{y}\mathbin{-}\mathrm{1})\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{hscode}\resethooks


\subsection*{QuickCheck}

%----------------- Outras definições auxiliares -------------------------------------------%
Lógicas:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{infixr}\;\mathrm{0}\Rightarrow{}\<[E]%
\\
\>[B]{}(\Rightarrow)\mathbin{::}(\Conid{Testable}\;\Varid{prop})\Rightarrow (\Varid{a}\to \Conid{Bool})\to (\Varid{a}\to \Varid{prop})\to \Varid{a}\to \Conid{Property}{}\<[E]%
\\
\>[B]{}\Varid{p}\Rightarrow\Varid{f}\mathrel{=}\lambda \Varid{a}\to \Varid{p}\;\Varid{a}\Rightarrow\Varid{f}\;\Varid{a}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{infixr}\;\mathrm{0}\Leftrightarrow{}\<[E]%
\\
\>[B]{}(\Leftrightarrow)\mathbin{::}(\Varid{a}\to \Conid{Bool})\to (\Varid{a}\to \Conid{Bool})\to \Varid{a}\to \Conid{Property}{}\<[E]%
\\
\>[B]{}\Varid{p}\Leftrightarrow\Varid{f}\mathrel{=}\lambda \Varid{a}\to (\Varid{p}\;\Varid{a}\Rightarrow\Varid{property}\;(\Varid{f}\;\Varid{a}))\mathbin{.\&\&.}(\Varid{f}\;\Varid{a}\Rightarrow\Varid{property}\;(\Varid{p}\;\Varid{a})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{infixr}\;\mathrm{4}\equiv{}\<[E]%
\\
\>[B]{}(\equiv)\mathbin{::}\Conid{Eq}\;\Varid{b}\Rightarrow (\Varid{a}\to \Varid{b})\to (\Varid{a}\to \Varid{b})\to (\Varid{a}\to \Conid{Bool}){}\<[E]%
\\
\>[B]{}\Varid{f}\equiv\Varid{g}\mathrel{=}\lambda \Varid{a}\to \Varid{f}\;\Varid{a}\equiv \Varid{g}\;\Varid{a}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{infixr}\;\mathrm{4}\leq{}\<[E]%
\\
\>[B]{}(\leq)\mathbin{::}\Conid{Ord}\;\Varid{b}\Rightarrow (\Varid{a}\to \Varid{b})\to (\Varid{a}\to \Varid{b})\to (\Varid{a}\to \Conid{Bool}){}\<[E]%
\\
\>[B]{}\Varid{f}\leq\Varid{g}\mathrel{=}\lambda \Varid{a}\to \Varid{f}\;\Varid{a}\leq \Varid{g}\;\Varid{a}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{infixr}\;\mathrm{4}\wedge{}\<[E]%
\\
\>[B]{}(\wedge)\mathbin{::}(\Varid{a}\to \Conid{Bool})\to (\Varid{a}\to \Conid{Bool})\to (\Varid{a}\to \Conid{Bool}){}\<[E]%
\\
\>[B]{}\Varid{f}\wedge\Varid{g}\mathrel{=}\lambda \Varid{a}\to ((\Varid{f}\;\Varid{a})\mathrel{\wedge}(\Varid{g}\;\Varid{a})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Arbitrary}\;\Conid{Cell}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\mbox{\onelinecomment  1/4 chance of generating a cell 'Block'.}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{arbitrary}\mathrel{=}\mathbf{do}\;\Varid{x}\leftarrow \Varid{chooseInt}\;(\mathrm{0},\mathrm{3}){}\<[E]%
\\
\>[3]{}\hsindent{15}{}\<[18]%
\>[18]{}\Varid{return}\mathbin{\$}\Varid{f}\;\Varid{x}\;\mathbf{where}{}\<[E]%
\\
\>[18]{}\hsindent{2}{}\<[20]%
\>[20]{}\Varid{f}\;\Varid{x}\mathrel{=}\mathbf{if}\;\Varid{x}\mathbin{<}\mathrm{3}\;\mathbf{then}\;\Conid{Free}\;\mathbf{else}\;\Conid{Blocked}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\newpage
%----------------- Soluções dos alunos -----------------------------------------%

\section{Soluções dos alunos}\label{sec:resolucao}
Os alunos devem colocar neste anexo as suas soluções para os exercícios
propostos, de acordo com o "layout" que se fornece. Não podem ser
alterados os nomes ou tipos das funções dadas, mas pode ser adicionado
texto, diagramas e/ou outras funções auxiliares que sejam necessárias.

Valoriza-se a escrita de \emph{pouco} código que corresponda a soluções
simples e elegantes.

\subsection*{Problema 1} \label{pg:P1}

\textbf{Alínea 1 - }Gerar LTree a partir da lista de transações.

\paragraph{}
Para a resolução desta alínea, foi-nos pedido que utilizássemos um tipo de dado correspondente a uma lista não vazia (NEList). 
Para isso começamos por calcular, a partir do inNEList, o isomorfismo outNEList, assim como as restantes funções de catamorfismo, anamorfismo... etc.

\paragraph{}
Cálculo do outNEList:
\begin{eqnarray*}
\start
     \ensuremath{\Varid{outNEList}\comp \Varid{inNEList}\mathrel{=}\Varid{id}}
%
\just\equiv{ Def inNEList = [singl,cons] }
%
     \ensuremath{\Varid{outNEList}\comp [\mskip1.5mu \Varid{singl},\Varid{cons}\mskip1.5mu]\mathrel{=}\Varid{id}}
%
\just\equiv{ Fusão-+ (20) }
%
     \ensuremath{[\mskip1.5mu \Varid{outNEList}\comp \Varid{singl},\Varid{outNEList}\comp \Varid{cons}\mskip1.5mu]\mathrel{=}\Varid{id}}
%
\just\equiv{ Universal-+ (27) }
%
        \ensuremath{\begin{lcbr}\Varid{id}\comp i_1\mathrel{=}\Varid{outNEList}\comp \Varid{singl}\\\Varid{id}\comp i_2\mathrel{=}\Varid{outNEList}\comp \Varid{cons}\end{lcbr}}
%
\just\equiv{ Natural-id (1), Troca de membros }
%
        \ensuremath{\begin{lcbr}\Varid{outNEList}\comp \Varid{singl}\mathrel{=}i_1\\\Varid{outNEList}\comp \Varid{cons}\mathrel{=}i_2\end{lcbr}}
%
\just\equiv{ Igualdade Extensional (71) }
%
        \ensuremath{\begin{lcbr}\Varid{outNEList}\comp \Varid{singl}\;\Varid{a}\mathrel{=}i_1\;\Varid{a}\\\Varid{outNEList}\comp \Varid{cons}\;(\Varid{a},\Varid{b})\mathrel{=}i_2\;(\Varid{a},\Varid{b})\end{lcbr}}
%
\just\equiv{ Def singl, Def cons }
%
        \ensuremath{\begin{lcbr}\Varid{outNEList}\;[\mskip1.5mu \Varid{a}\mskip1.5mu]\mathrel{=}i_1\;\Varid{a}\\\Varid{outNEList}\;(\Varid{a}\mathbin{:}\Varid{b})\mathrel{=}i_2\;(\Varid{a},\Varid{b})\end{lcbr}}
\end{eqnarray*}


Listas vazias:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{12}{@{}>{\hspre}l<{\hspost}@{}}%
\column{16}{@{}>{\hspre}l<{\hspost}@{}}%
\column{17}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{outNEList}\;[\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[17]%
\>[17]{}\mathrel{=}i_1\;\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{outNEList}\;(\Varid{h}\mathbin{:}\Varid{t})\mathrel{=}i_2\;(\Varid{h},\Varid{t}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{baseNEList}\;\Varid{f}\;\Varid{g}\mathrel{=}\Varid{id}+\Varid{f}\times\Varid{g}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{recNEList}\;{}\<[12]%
\>[12]{}\Varid{f}{}\<[16]%
\>[16]{}\mathrel{=}\Varid{id}+\Varid{id}\times\Varid{f}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{cataNEList}\;\Varid{g}{}\<[16]%
\>[16]{}\mathrel{=}\Varid{g}\comp \Varid{recNEList}\;(\Varid{cataNEList}\;\Varid{g})\comp \Varid{outNEList}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{anaNEList}\;{}\<[12]%
\>[12]{}\Varid{g}{}\<[16]%
\>[16]{}\mathrel{=}\Varid{inNEList}\comp \Varid{recNEList}\;(\Varid{anaNEList}\;\Varid{g})\comp \Varid{g}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{hyloNEList}\;\Varid{h}\;\Varid{g}\mathrel{=}\Varid{cataNEList}\;\Varid{h}\comp \Varid{anaNEList}\;\Varid{g}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

Depois de calculada estas funções, começamos por desenvolver o diagrama do anamorfismo que constrói LTrees a partir de listas não vazias.
Depois do diagrama concluído e a tipagem dos dados verificada, calculamos o gene do anamorfismo.

\newpage
Diagrama do anamorfismo a resolver
\paragraph{}
\xymatrix@C=2cm{
     \ensuremath{{\LTree}\;\Conid{A}} 
     && 
     \ensuremath{\Conid{A}\mathbin{+}({\LTree}\;\Conid{A}\times{\LTree}\;\Conid{A})} \ar[ll]_-{inLTree}
\\
     \ensuremath{\Conid{A}}^* \ar[r]^-{\ensuremath{\Varid{outNEList}}} \ar[u]^-{\ensuremath{\Varid{list2LTree}}} \ar@/_1.5pc/[rr]_-{\ensuremath{\Varid{g\char95 list2LTree}}}
&
     \ensuremath{\Conid{A}\mathbin{+}(\Conid{A}\times\Conid{A}}^*\ensuremath{)} \ar[r]^-{\ensuremath{\Varid{id}\mathbin{+}\Varid{divLista}\comp \Varid{cons}}}
&
     \ensuremath{\Conid{A}\mathbin{+}(\Conid{A}}^* \ensuremath{\times\Conid{A}}^*\ensuremath{)} \ar[u]_-{\ensuremath{\Varid{id}\mathbin{+}\Varid{list2LTree}}^2} 
}

\paragraph{}
Como podemos ver no diagrama, o gene será uma composição de duas funções: a função outNEList já calculada, e uma função auxiliar intermédia.
Esta função intermédia é definida como uma alternativa onde, no caso desta receber uma lista singular (etiqueta 1/esquerda), não efetua modificações nesta.
Caso receba um par constituído pela cabeça e a cauda da lista (etiqueta 2/direita), começa por construir a lista original, passando esta para 
a função divLista, que irá dividir a lista em duas partes iguais, gerando um par de listas.
\paragraph{}
Gene do anamorfismo:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{40}{@{}>{\hspre}l<{\hspost}@{}}%
\column{71}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{g\char95 list2LTree}\mathrel{=}(\Varid{id}+\Varid{divLista}\comp \Varid{cons})\comp \Varid{outNEList}{}\<[E]%
\\
\>[B]{}\Varid{divLista}\;\Varid{l}\mathrel{=}((\Varid{take}\;((\length \;\Varid{l})\mathbin{\Varid{`div`}}{}\<[40]%
\>[40]{}\mathrm{2})\;\Varid{l}),(\Varid{drop}\;((\length \;\Varid{l})\mathbin{\Varid{`div`}}{}\<[71]%
\>[71]{}\mathrm{2})\;\Varid{l})){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\paragraph{}
\paragraph{}
\textbf{Alínea 2 - }Gerar a MerkleTree a partir da LTree.
\paragraph{}
Para a resolução desta alínea, repetimos o mesmo processo, desenvolvendo um diagrama do catamorfismo a ser resolvido, tendo em atenção os vários tipos de dados gerados por cada função. 
\paragraph{}
Diagrama do catamorfismo a resolver:
\begin{eqnarray*}
\xymatrix@C=2cm{
    \ensuremath{{\LTree}\;\Conid{A}}
           \ar[d]_-{\ensuremath{\Varid{lTree2MTree}}}
&
    \ensuremath{\Conid{A}\mathbin{+}({\LTree}\;\Conid{A})}^2
           \ar[d]^{\ensuremath{\Varid{id}\mathbin{+}\Varid{lTree2MTree}}^2}
           \ar[l]_-{\ensuremath{\mathsf{in}\mathrel{=}\alt{\Conid{Leaf}}{\Conid{Fork}}}}
\\
     \ensuremath{{\FTree}\;\Conid{Z}\;(\Conid{Z}\times\Conid{A})}
&
     \ensuremath{\Conid{A}\mathbin{+}({\FTree}\;\Conid{Z}\;(\Conid{Z}\times\Conid{A}))}^2
           \ar[l]^-{\ensuremath{\Varid{g\char95 lTree2MTree}}}
}
\end{eqnarray*}


\paragraph{}
Para o calculo deste gene, utilizamos uma alternativa de funções onde, no caso desta apenas receber uma transação (etiqueta 1/esquerda), 
apenas efetuará o hashing desta, assim como a criação de um MerkleTree singular (Unit).
Caso receba um par constituído por duas MerkleTrees, esta cria um par, onde o primeiro elemento será a concatenação das hashes destas,
e o segundo elemento será constituído pelas suas sub-árvores.
\paragraph{}
Gene do catamorfismo:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{11}{@{}>{\hspre}l<{\hspost}@{}}%
\column{17}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{g\char95 lTree2MTree}\mathbin{::}\Conid{Hashable}\;\Varid{c}\Rightarrow \Varid{c}+({\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{c}),{\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{c}))\to {\FTree}\;\mathbb{Z}\;(\mathbb{Z},\Varid{c}){}\<[E]%
\\
\>[B]{}\Varid{g\char95 lTree2MTree}\mathrel{=}\alt{\Varid{g1}}{\Varid{g2}}{}\<[E]%
\\
\>[B]{}\hsindent{11}{}\<[11]%
\>[11]{}\mathbf{where}\;\Varid{g1}\mathrel{=}\Conid{Unit}\comp \conj{\Varid{\Conid{Main}.hash}}{\Varid{id}}{}\<[E]%
\\
\>[11]{}\hsindent{6}{}\<[17]%
\>[17]{}\Varid{g2}\mathrel{=}\uncurry{\Conid{Comp}}\comp \conj{\Varid{\Conid{Main}.concHash}\comp ((\Varid{firsts}\comp \mathsf{out})\times(\Varid{firsts}\comp \mathsf{out}))}{\Varid{id}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\newpage
\textbf{Alínea 3 - }Obter a raíz da MerkleTree.
\paragraph{}
Para esta alínea, é apenas preciso retirar a hash presente na raiz da MerkleTree, para isso, utilizamos a função pré-definida firsts, que retira a Hash presente na MerkleTree.
\paragraph{}
Gene de \ensuremath{\Varid{mroot}} ("get Merkle root"):
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{g\char95 mroot}\mathrel{=}\Varid{firsts}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks


\textbf{Alínea 4 - }Valorização. (por fazer)

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{pairsList}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu (\Varid{a},\Varid{a})\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{pairsList}\mathrel{=}\anaList{\Varid{g\char95 pairsList}}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{g\char95 pairsList}\mathrel{=}\bot {}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{classicMerkleTree}\mathbin{::}\Conid{Hashable}\;\Varid{a}\Rightarrow [\mskip1.5mu \Varid{a}\mskip1.5mu]\to {\FTree}\;\mathbb{Z}\;\mathbb{Z}{}\<[E]%
\\
\>[B]{}\Varid{classicMerkleTree}\mathrel{=}(\Varid{hyloNEList}\;\Varid{conquer}\;\Varid{divide})\comp (\map \;\Varid{\Conid{Main}.hash}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{divide}\mathrel{=}\bot {}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{conquer}\mathrel{=}\alt{\Varid{head}}{\Varid{joinMerkleTree}}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{7}{}\<[7]%
\>[7]{}\Varid{joinMerkleTree}\;(\Varid{l},\Varid{m})\mathrel{=}\Varid{mergeMerkleTree}\;\Varid{m}\;(\Varid{evenMerkleTreeList}\;\Varid{l}){}\<[E]%
\\
\>[B]{}\hsindent{7}{}\<[7]%
\>[7]{}\Varid{mergeMerkleTree}\mathrel{=}\llparenthesis\, \alt{h_1 }{h_2 }\,\rrparenthesis{}\<[E]%
\\
\>[B]{}\hsindent{7}{}\<[7]%
\>[7]{}h_1 \;\Varid{c}\;\Varid{l}\mathrel{=}\bot {}\<[E]%
\\
\>[B]{}\hsindent{7}{}\<[7]%
\>[7]{}h_2 \;(\Varid{c},(\Varid{f},\Varid{g}))\;\Varid{l}\mathrel{=}\bot {}\<[E]%
\\
\>[B]{}\hsindent{7}{}\<[7]%
\>[7]{}\Varid{evenMerkleTreeList}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\newpage
\subsection*{Problema 2}
\paragraph{}
Para a resolução deste problema, começamos por calcular as versões \textit{pointfree} das funções fornecidas no enunciado.
Tendo em conta que o problema parte de resolver pela aplicação da lei da recursividade mútua:
\begin{eqnarray*}
\ensuremath{\conj{\Varid{f}}{\Varid{g}}\mathrel{=}\cata{\conj{\Varid{h}}{\Varid{k}}}}
\end{eqnarray*}

Começamos por aplicar a lei de Fokkinga (52):

\begin{eqnarray}
\start
     \ensuremath{\Varid{wc\char95 w}\comp \mathsf{in}\mathrel{=}\Varid{h}\comp \fun F \;\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}}}
%
\just\equiv{ \ensuremath{\mathsf{in}\mathbin{:=}\alt{\Varid{nil}}{\Varid{cons}}} ; \ensuremath{\Varid{h}\mathbin{:=}\alt{h_1 }{h_2 }} ; \ensuremath{\fun F \;\Varid{f}\mathrel{=}\Varid{id}\mathbin{+}\Varid{id}\times\Varid{f}}}
     \ensuremath{\Varid{wc\char95 w}\comp \alt{\Varid{nil}}{\Varid{cons}}\mathrel{=}\alt{h_1 }{h_2 }\comp (\Varid{id}\mathbin{+}\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})}
%
\just\equiv{ Fusão-+ (20) ; Absorção-+ (22)}
     \ensuremath{\alt{\Varid{wc\char95 w}\comp \Varid{nil}}{\Varid{wc\char95 w}\comp \Varid{cons}}\mathrel{=}\alt{h_1 \comp \Varid{id}}{h_2 \comp (\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})}}
%
\just\equiv{ Eq-+ (27); Natural-id (1)}
          \ensuremath{\begin{lcbr}\Varid{wc\char95 w}\comp \Varid{nil}\mathrel{=}h_1 \\\Varid{wc\char95 w}\comp \Varid{cons}\mathrel{=}h_2 \comp (\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})\end{lcbr}}
%
\just\equiv{ Igualdade Extensional (71) ; Def-comp (72); Def-const (74), Def-nil}
          \ensuremath{\begin{lcbr}\Varid{wc\char95 w}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}h_1 \;\Varid{a}\\\Varid{wc\char95 w}\;(\Varid{cons}\;\Varid{a})\mathrel{=}h_2 \;((\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})\;\Varid{a})\end{lcbr}}
%
\just\equiv{ \ensuremath{\Varid{wc\char95 w}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\mathrm{0}} ; a := (a,b) ; Def-x (77)}
          \ensuremath{\begin{lcbr}\mathrm{0}\mathrel{=}h_1 \;\Varid{a}\\\Varid{wc\char95 w}\;(\Varid{cons}\;(\Varid{a},\Varid{b}))\mathrel{=}h_2 \;(\Varid{id}\;\Varid{a},\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}}\;\Varid{b})\end{lcbr}}
%
\just\equiv{ Def-id (73); Def-split (76); Def-cons}
          \ensuremath{\begin{lcbr}\mathrm{0}\mathrel{=}h_1 \;\Varid{a}\\\Varid{wc\char95 w}\;(\Varid{a}\mathbin{:}\Varid{b})\mathrel{=}h_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\end{lcbr}}
%
\just\equiv{ Propriedade reflexiva da igualdade ; \ensuremath{\Varid{wc\char95 w}\;(\Varid{a}\mathbin{:}\Varid{b})\mathrel{=}\mathbf{if}\;\neg \;(\Varid{sp}\;\Varid{a})\mathrel{\wedge}\Varid{lookahead\char95 sep}\;\Varid{b}\;\mathbf{then}\;\Varid{wc\char95 w}\;\Varid{b}\mathbin{+}\mathrm{1}\;\mathbf{else}\;\Varid{wc\char95 w}\;\Varid{b}}}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\mathrel{=}\mathbf{if}\;\neg \;(\Varid{sp}\;\Varid{a})\mathrel{\wedge}\Varid{lookahead\char95 sep}\;\Varid{b}\;\mathbf{then}\;\Varid{wc\char95 w}\;\Varid{b}\mathbin{+}\mathrm{1}\;\mathbf{else}\;\Varid{wc\char95 w}\;\Varid{b}\end{lcbr}}
%
\just\equiv{Def-cond (78)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\mathrel{=}\Varid{cond}\;(\neg \;(\Varid{sp}\;\Varid{a})\mathrel{\wedge}\Varid{lookahead\char95 sep}\;\Varid{b})\;(\Varid{wc\char95 w}\;\Varid{b}\mathbin{+}\mathrm{1})\;(\Varid{wc\char95 w}\;\Varid{b})\end{lcbr}}
%
\just\equiv{Def succ; \ensuremath{\Varid{andOperator}} ; \ensuremath{\Varid{andOperator}\mathbin{:=}\Varid{and}} ; \ensuremath{\Varid{lookahead\char95 sep}\mathbin{:=}\Varid{la}} ; \ensuremath{\Varid{wc\char95 c}\mathbin{:=}\Varid{wc}} ; (Abreviaturas)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}\Varid{cond}\;(\Varid{and}\;(\neg \;(\Varid{sp}\;\Varid{a}),\Varid{la}\;\Varid{b}))\;(\succ \;(\Varid{wc}\;\Varid{b}))\;(\Varid{wc}\;\Varid{b})\end{lcbr}}
%
\just\equiv{Def-comp (72)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}\Varid{cond}\;(\Varid{and}\;((\neg \comp \Varid{sp})\;\Varid{a},\Varid{la}\;\Varid{b}))\;(\succ \;(\Varid{wc}\;\Varid{a}))\;(\Varid{wc}\;\Varid{b})\end{lcbr}}
%
\just\equiv{Def-proj (79)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}\Varid{cond}\;(\Varid{and}\;((\neg \comp \Varid{sp})\;\Varid{x},\p2\;(\Varid{wc}\;\Varid{y},\Varid{la}\;\Varid{y})))\;(\succ \;(\p1\;(\Varid{wc}\;\Varid{y},\Varid{la}\;\Varid{y})))\;(\p1\;(\Varid{wc}\;\Varid{y},\Varid{la}\;\Varid{y}))\end{lcbr}}
%
\just\equiv{Def-x (77), Def-comp (72)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}\Varid{cond}\;((\Varid{and}\comp ((\neg \comp \Varid{sp})\times\p2))\;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b})))\;((\succ \comp \p1)\;(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\;(\p1\;(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\end{lcbr}}
%
\just\equiv{Def-x (79), Def-comp (72)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}\Varid{cond}\;((\Varid{and}\comp ((\neg \comp \Varid{sp})\times\p2))\;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b})))\;((\succ \comp \p1\comp \p2)\;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b})))\;(\p1\comp \p2\;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b})))\end{lcbr}}
%
\just\equiv{Def-cond (78)}
        \ensuremath{\begin{lcbr}h_1 \;\Varid{a}\mathrel{=}\mathrm{0}\\h_2 \;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\mathrel{=}(\Varid{cond}\;(\Varid{and}\comp ((\neg \comp \Varid{sp})\times\p2))\;(\succ \comp \p1\comp \p2)\;(\p1\comp \p2))\;(\Varid{a},(\Varid{wc}\;\Varid{b},\Varid{la}\;\Varid{b}))\end{lcbr}}
\end{eqnarray}

Do último passo que determinou a versão \textit{pointwise} deduzimos que:
que $\ensuremath{h_1 }$ é $\ensuremath{\Varid{zero}}$ e $\ensuremath{h_2 }$ é a função
$\ensuremath{\Varid{cond}\;(\Varid{andOperator}\comp ((\neg \comp \Varid{sp})\times\p2))\;(\succ \comp \p1\comp \p2)\;(\p1\comp \p2)}$.

Vejamos agora como podemos calcular k, começando novamente pela lei de Fokkinga (52):


\begin{eqnarray}
\start
     \ensuremath{\Varid{lookahead\char95 sep}\comp \mathsf{in}\mathrel{=}\Varid{k}\comp \fun F \;\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}}}
%
\just\equiv{ \ensuremath{\mathsf{in}\mathbin{:=}\alt{\Varid{nil}}{\Varid{cons}}} ; \ensuremath{\Varid{k}\mathbin{:=}\alt{k_1 }{k_2 }} ; \ensuremath{\fun F \;\Varid{f}\mathrel{=}\Varid{id}\mathbin{+}\Varid{id}\times\Varid{f}}}
     \ensuremath{\Varid{lookahead\char95 sep}\comp \alt{\Varid{nil}}{\Varid{cons}}\mathrel{=}\alt{k_1 }{k_2 }\comp (\Varid{id}\mathbin{+}\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})}
%
\just\equiv{ Fusão-+ (20) ; Absorção-+ (22)}
     \ensuremath{\alt{\Varid{lookahead\char95 sep}\comp \Varid{nil}}{\Varid{lookahead\char95 sep}\comp \Varid{cons}}\mathrel{=}\alt{k_1 \comp \Varid{id}}{k_2 \comp (\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})}}
%
\just\equiv{ Eq-+ (27); Natural-id (1)}
          \ensuremath{\begin{lcbr}\Varid{lookahead\char95 sep}\comp \Varid{nil}\mathrel{=}k_1 \\\Varid{lookahead\char95 sep}\comp \Varid{cons}\mathrel{=}k_2 \comp (\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})\end{lcbr}}
%
\just\equiv{ Igualdade Extensional (71); Def-comp (72); Def-const (74), Def nil}
          \ensuremath{\begin{lcbr}\Varid{lookahead\char95 sep}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}k_1 \;\Varid{a}\\\Varid{lookahead\char95 sep}\;(\Varid{cons}\;\Varid{a})\mathrel{=}k_2 \;((\Varid{id}\times\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}})\;\Varid{a})\end{lcbr}}
%
\just\equiv{ \ensuremath{\Varid{lookahead\char95 sep}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\Conid{True}} ; a := (a,b) ; Def-x (77)}
          \ensuremath{\begin{lcbr}\Conid{True}\mathrel{=}k_1 \;\Varid{a}\\\Varid{lookahead\char95 sep}\;(\Varid{cons}\;(\Varid{a},\Varid{b}))\mathrel{=}h_2 \;(\Varid{id}\;\Varid{a},\conj{\Varid{wc\char95 w}}{\Varid{lookahead\char95 sep}}\;\Varid{b})\end{lcbr}}
%
\just\equiv{ Def-id (73); Def-split (76) ; Def cons}
          \ensuremath{\begin{lcbr}\Conid{True}\mathrel{=}k_1 \;\Varid{a}\\\Varid{lookahead\char95 sep}\;(\Varid{a}\mathbin{:}\Varid{b})\mathrel{=}k_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\end{lcbr}}
%
\just\equiv{\ensuremath{\Varid{lookahead\char95 sep}\;(\Varid{aby})\mathrel{=}\Varid{sp}\;\Varid{a}}}
          \ensuremath{\begin{lcbr}\Conid{True}\mathrel{=}k_1 \;\Varid{a}\\\Varid{sp}\;\Varid{x}\mathrel{=}k_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\end{lcbr}}
%
\just\equiv{Propriedade reflexiva da igualdade}
        \ensuremath{\begin{lcbr}k_1 \;\Varid{a}\mathrel{=}\Conid{True}\\k_2 \;(\Varid{a},(\Varid{wc\char95 w}\;\Varid{b},\Varid{lookahead\char95 sep}\;\Varid{b}))\mathrel{=}\Varid{sp}\;\Varid{a}\end{lcbr}}
\end{eqnarray}

Assim, chegamos à conclusão que $\ensuremath{k_1 }$ é sempre $\ensuremath{\underline{\Conid{True}}}$ e $\ensuremath{k_2 }$ é dado pela função $\ensuremath{\Varid{sp}\comp \p1}$.
\newpage
Utilizando a Lei da Troca, podemos obter a definição final do gene da função worker.
\begin{eqnarray*}
\start
     \ensuremath{\cata{\conj{\alt{h_1 }{h_2 }}{\alt{k_1 }{k_2 }}}}
%
\just\equiv{ Lei da troca (28) }
%
     \ensuremath{\cata{\alt{\conj{h_1 }{k_1 }}{\conj{h_2 }{k_2 }}}}
\end{eqnarray*}
\paragraph{}
Para o wrapper, apenas precisamos de retirar o primeiro elemento do par gerado pelo worker, pois contém o número de todas as palavras lidas.
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{wc\char95 w\char95 final}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{wc\char95 w\char95 final}\mathrel{=}\Varid{wrapper}\comp \Varid{worker}{}\<[E]%
\\
\>[B]{}\Varid{worker}\mathrel{=}\cataList{\alt{\Varid{g1}}{\Varid{g2}}}{}\<[E]%
\\
\>[B]{}\Varid{wrapper}\mathrel{=}\Varid{fromInteger}\comp \p1{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Gene de \ensuremath{\Varid{worker}}:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{g1}\mathrel{=}\conj{h_1 }{k_1 }{}\<[E]%
\\
\>[B]{}\Varid{g2}\mathrel{=}\conj{h_2 }{k_2 }{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Genes \ensuremath{\Varid{h}\mathrel{=}\alt{h_1 }{h_2 }} e \ensuremath{\Varid{k}\mathrel{=}\alt{k_1 }{k_2 }} identificados no cálculo:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}h_1 \mathrel{=}\Varid{zero}{}\<[E]%
\\
\>[B]{}h_2 \mathrel{=}\Varid{cond}\;(\Varid{andOperator}\comp ((\neg \comp \Varid{sp})\times\p2))\;(\succ \comp \p1\comp \p2)\;(\p1\comp \p2){}\<[E]%
\\
\>[B]{}k_1 \mathrel{=}\underline{\Conid{True}}{}\<[E]%
\\
\>[B]{}k_2 \mathrel{=}\Varid{sp}\comp \p1{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{andOperator}\;(\Varid{x},\Varid{y})\mathrel{=}\Varid{x}\mathrel{\wedge}\Varid{y}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\paragraph{}
Como podemos ver, o gene da função worker, ao receber uma lista vazia, apenas gere uma par (0,True), indicando que não leu nenhuma palavra e levanta a flag
de separador, para indicar que próximos caracteres irão pertencer a uma nova palavra. No caso do gene receber um par composto por um caracter e o par (Integer,Bool)
anterior, este irá avaliar o caracter a ser lido, assim como a flag presente, incrementando assim ou não o contador de palavras, gerando também um Bool
dependendo do caracter lido.
\par
Apresentamos aqui o diagrama do catamorfismo do worker da função:
\paragraph{}
\xymatrix@C=2cm{
     Char^{*}  \ar[d]_-{worker}
     & 
     1 + (Char \times Char^{*}) \ar[d]^-{\ensuremath{\Varid{recList}\;(\Varid{worker})}} \ar[l]_-{\ensuremath{\mathbf{in}\mathrel{=}\alt{\Varid{nil}}{\Varid{cons}}}}
\\
     (Integer,Bool)
     &
     1 + (Char \times (Integer,Bool))  \ar[l]_-{\ensuremath{[\mskip1.5mu \Varid{g1},\Varid{g2}\mskip1.5mu]}} 
}

\newpage
\subsection*{Problema 3}

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{inX}\mathbin{::}\Varid{u}+(\Varid{i},(\Conid{X}\;\Varid{u}\;\Varid{i},\Conid{X}\;\Varid{u}\;\Varid{i}))\to \Conid{X}\;\Varid{u}\;\Varid{i}{}\<[E]%
\\
\>[B]{}\Varid{inX}\mathrel{=}\alt{\Conid{XLeaf}}{\uncurry{\uncurry{\Conid{Node}}}\comp \Varid{assocl}}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{outX}\;(\Conid{XLeaf}\;\Varid{u})\mathrel{=}i_1\;\Varid{u}{}\<[E]%
\\
\>[B]{}\Varid{outX}\;(\Conid{Node}\;\Varid{i}\;\Varid{l}\;\Varid{r})\mathrel{=}i_2\;(\Varid{i},(\Varid{l},\Varid{r})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{baseX}\;\Varid{f}\;\Varid{h}\;\Varid{g}\mathrel{=}\Varid{f}+(\Varid{h}\times(\Varid{g}\times\Varid{g})){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{recX}\;\Varid{f}\mathrel{=}\Varid{baseX}\;\Varid{id}\;\Varid{id}\;\Varid{f}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{cataX}\;\Varid{g}\mathrel{=}\Varid{g}\comp (\Varid{recX}\;(\Varid{cataX}\;\Varid{g}))\comp \Varid{outX}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks

Inserir a partir daqui o resto da resolução deste problema:

....
\begin{hscode}\SaveRestoreHook
\ColumnHook
\end{hscode}\resethooks

\newpage
\subsection*{Problema 4}

\textbf{Alínea 1 - }Função pairL
\paragraph{}
Para o cálculo desta função, começamos por desenvolver o diagrama do anamorfismo, utilizando os vários construtores de Listas.
\paragraph{}
\xymatrix@C=2cm{
     (A,A)^{*} 
     && 
     1 + ((A,A) \times (A,A)^{*}) \ar[ll]_-{inList}
\\
     A^{*} \ar[r]^-{\ensuremath{\Varid{outList}}} \ar[u]^-{\ensuremath{\Varid{pairL}}} \ar@/_1.5pc/[rr]_-{\ensuremath{\Varid{g}}}
&
     1 + (A \times A^{*}) \ar[r]^-{\ensuremath{\Varid{id}\mathbin{+}\Varid{pairHandler}}}
&
     1 + ((A,A) \times A^{*}) \ar[u]_-{\ensuremath{\Varid{recList}\;(\Varid{pairL})}} 
}

\paragraph{}
Para o gene do anamorfismo, começamos por criar uma composição das funções \ensuremath{\Varid{outList}} e a função que será responsável pela criação dos pares.
Definimos esta função como uma alternativa de um \ensuremath{\Varid{id}} com uma subfunção chamada \ensuremath{\Varid{pairHandler}}. Esta função começa por avaliar se a lista fornecida era singular,
pois assim gere apenas um par repetido (\ensuremath{\Varid{singlePair}}). Caso a lista fornecida contenha múltiplos elementos (\ensuremath{\Varid{multiplePairs}}), este vai gerando os pares com a cabeça da lista e a cabeça da cauda.
Por fim, avalia se a cauda é uma lista singular, modificando-a para uma lista vazia para evitar a repetição do último elemento. 
\par
Tivemos também a necessidade de definir duas funções auxiliares \ensuremath{\Varid{emptyList}} e \ensuremath{\Varid{singlList}}. Estas apenas avaliam uma dada lista, indicando se esta está
vazia ou se contém apenas um elemento, respetivamente.

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{6}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{pairL}\mathbin{::}[\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu (\Varid{a},\Varid{a})\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{pairL}\mathrel{=}\anaList{\Varid{g}}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{6}{}\<[6]%
\>[6]{}\Varid{g}\mathrel{=}(\Varid{id}+\Varid{pairHandler})\comp \Varid{outList}{}\<[E]%
\\
\>[B]{}\hsindent{6}{}\<[6]%
\>[6]{}\Varid{pairHandler}\mathrel{=}\Varid{cond}\;(\Varid{emptyList}\comp \p2)\;\Varid{singlePair}\;\Varid{multiplePairs}{}\<[E]%
\\
\>[B]{}\hsindent{6}{}\<[6]%
\>[6]{}\Varid{singlePair}\mathrel{=}\conj{\conj{\p1}{\p1}}{\Varid{nil}}{}\<[E]%
\\
\>[B]{}\hsindent{6}{}\<[6]%
\>[6]{}\Varid{multiplePairs}\mathrel{=}\conj{\conj{\p1}{\Varid{head}\comp \p2}}{\Varid{cond}\;(\Varid{singlList}\comp \p2)\;\Varid{nil}\;\p2}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{emptyList}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\Conid{True}{}\<[E]%
\\
\>[B]{}\Varid{emptyList}\;\anonymous \mathrel{=}\Conid{False}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{singlList}\;[\mskip1.5mu \Varid{x}\mskip1.5mu]\mathrel{=}\Conid{True}{}\<[E]%
\\
\>[B]{}\Varid{singlList}\;\anonymous \mathrel{=}\Conid{False}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks


\textbf{Alínea 2 - }Função markMap

\paragraph{}
Para esta alínea, apercebemo-nos que a função objetivo se tratava de um hilomorfismo. Como tal, conseguimos distinguir as duas etapas
constituintes da mesma: \ensuremath{\Varid{divide}\;\Varid{and}\;\Varid{conquer}}. A técnica de \ensuremath{\Varid{divide}}, neste caso em específico, refere-se à construção (anamorfismo) de pares de posições
a partir de uma lista de posições iniciais. Na segunda parte (\ensuremath{\Varid{conquer}}), é necessário consumir (catamorifismo) as mesmas posições, obtendo o mapa com todas 
as movimentações. 
\par
Como a primeira parte deste hilomorfismo já foi desenvolvida na alínea anterior (\ensuremath{\Varid{pairL}}), começamos por desenvolver a etapa de \ensuremath{\Varid{conquer}}, 
criando o diagrama do catamorfismo, no entanto, encontramos problemas com a tipagem devido à receção do argumento Map, ficando sem saber 
como este era introduzido no diagrama. 
\par
Decidimos por isso começar por desenvolver uma função que, ao receber um par de posições e um mapa, efetuava a modificação correta neste (\ensuremath{\Varid{updateCell}}). 
Para esta função foi necessário desenvolver as funções auxiliares \ensuremath{\Varid{updateElemList}} e \ensuremath{\Varid{getAtIndex}}, sendo que a primeira atualiza um elemento numa dada lista,
numa posição, e a segunda apenas retorna o elemento num dado index.
\par
Com esta função, conseguimos efetuar modificações no mapa, no entanto, não tivemos sucesso ao implementa-la no catamorfismo visto que não conseguimos efetuar
as modificações utilizando o mapa que é originado da aplicação do functor recursivo, devido à tipagem deste ser (\ensuremath{\Conid{Map}\to \Conid{Map}}) quando nós apenas esperavamos Map.
\par
Na versão final apresentamos a seguinte definição do gene, esta está incompleta e apenas efetua a modificação do primeiro "passo" efetuado, dado que não
conseguimos utilizar o mapa "modificado" até aquele ponto. Apresentamos também uma função \ensuremath{\Varid{updateMap}} que faz todas modificações, obtendo o mapa pretendido,
no entanto, não utiliza nenhum catamorfismo. Acreditamos que no futuro, com uma melhor análise da tipagem dos dados, se possa solucionar facilmente o problema em questão. 
\paragraph{}

\xymatrix@C=2cm{
     Pos^{*} \ar[d]^-{\ensuremath{\Varid{pairL}}} \ar@/_3pc/[dd]_-{\ensuremath{\Varid{markMap}\;\Varid{m}}} \ar[r]^-{g=\ensuremath{\alt{\Varid{id}}{\Varid{pairHandler}}\comp \Varid{outList}}}
     &
     1 + ((Pos,Pos) \times Pos^{*}) \ar[d]^-{\ensuremath{\Varid{recList}\;(\Varid{pairL})}}
\\
     (Pos \times Pos)^{*} \ar[r]^-{outList} \ar[d]^-{\ensuremath{\cataList{\alt{\underline{\Varid{id}}}{f_2 }}\;\Varid{m}}}
     & 
     1 + ((Pos \times Pos) \times (Pos \times Pos)^{*}) \ar[d]^-{\ensuremath{\Varid{recList}\;\cataList{\alt{\underline{\Varid{id}}}{f_2 }}\;\Varid{m}}}
\\
     Map
     &
     1 + ((Pos \times Pos) \times Map)  \ar[l]_-{\ensuremath{\alt{\underline{\Varid{id}}}{f_2 }}} 
}


\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{markMap}\mathbin{::}[\mskip1.5mu \Conid{Pos}\mskip1.5mu]\to \Conid{Map}\to \Conid{Map}{}\<[E]%
\\
\>[B]{}\Varid{markMap}\;\Varid{l}\mathrel{=}\cataList{\alt{\underline{\Varid{id}}}{f_2 }}\;(\Varid{pairL}\;\Varid{l})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \mathrel{=}\Varid{updateCell}\comp \p1{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{updateCell}\mathbin{::}(\Conid{Pos},\Conid{Pos})\to \Conid{Map}\to \Conid{Map}{}\<[E]%
\\
\>[B]{}\Varid{updateCell}\;(\Varid{po1}\mathord{@}(\Varid{x1},\Varid{y1}),\Varid{po2})\;\Varid{m}\mathrel{=}\Varid{updateElemList}\;\Varid{y1}\;(\Varid{updateElemList}\;\Varid{x1}\;(\Varid{toCell}\;\Varid{po1}\;\Varid{po2})\;(\Varid{getAtIndex}\;\Varid{y1}\;\Varid{m}))\;\Varid{m}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{updateElemList}\mathbin{::}{}\<[20]%
\>[20]{}\Conid{Int}\to \Varid{a}\to [\mskip1.5mu \Varid{a}\mskip1.5mu]\to [\mskip1.5mu \Varid{a}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{updateElemList}\;\Varid{n}\;\Varid{x}\;\Varid{l}\mathrel{=}\uncurry{(\mathbin{+\!\!\!+})}\;(((\Varid{id}\times\overline{\Varid{cons}}\;\Varid{x}\comp \Varid{drop}\;\mathrm{1})\comp (\Varid{splitAt}\;\Varid{n}))\;\Varid{l}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{getAtIndex}\mathbin{::}\Conid{Int}\to [\mskip1.5mu \Varid{a}\mskip1.5mu]\to \Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{getAtIndex}\;\mathrm{0}\;(\Varid{h}\mathbin{:}\Varid{t})\mathrel{=}\Varid{h}{}\<[E]%
\\
\>[B]{}\Varid{getAtIndex}\;\Varid{n}\;(\Varid{h}\mathbin{:}\Varid{t})\mathrel{=}\Varid{getAtIndex}\;(\Varid{n}\mathbin{-}\mathrm{1})\;\Varid{t}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
Função para atualização do mapa (Sem utilização do catamorfismo):
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{updateMap}\mathbin{::}[\mskip1.5mu (\Conid{Pos},\Conid{Pos})\mskip1.5mu]\to \Conid{Map}\to \Conid{Map}{}\<[E]%
\\
\>[B]{}\Varid{updateMap}\;[\mskip1.5mu \mskip1.5mu]\;\Varid{m}\mathrel{=}\Varid{m}{}\<[E]%
\\
\>[B]{}\Varid{updateMap}\;(\Varid{h}\mathbin{:}\Varid{t})\;\Varid{m}\mathrel{=}\Varid{updateMap}\;\Varid{t}\;(\Varid{updateCell}\;\Varid{h}\;\Varid{m}){}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\textbf{Alínea 3 - }Função scout

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{scout}\mathbin{::}\Conid{Map}\to \Conid{Pos}\to \Conid{Pos}\to \Conid{Int}\to [\mskip1.5mu [\mskip1.5mu \Conid{Pos}\mskip1.5mu]\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{scout}\;\Varid{m}\;\Varid{s}\;\Varid{t}\mathrel{=}\cataNat{\alt{f_1 }{(\bind f_2 \;\Varid{m}\;\Varid{s})}}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_1 \mathrel{=}\bot {}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}f_2 \mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks


\paragraph{Valorização} (opcional) Completar as seguintes funções de teste no \QuickCheck\ para verificação de propriedades das funções pedidas, a saber:

\begin{propriedade}  A lista correspondente ao lado esquerdo
dos pares em (\ensuremath{\Varid{pairL}\;\Varid{l}}) é a lista original \ensuremath{\Varid{l}} a menos do último elemento.
Analogamente, a lista correspondente ao lado direito
dos pares em (\ensuremath{\Varid{pairL}\;\Varid{l}}) é a lista original \ensuremath{\Varid{l}} a menos do primeiro elemento:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{prop\char95 reconst}\;\Varid{l}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{propriedade}

\begin{propriedade} 
Assuma que uma linha (de um mapa) é prefixa de uma outra linha. Então a representação
da primeira linha também prefixa a representação da segunda linha:
\end{propriedade}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{prop\char95 prefix2}\;\Varid{l}\;\Varid{l'}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\begin{propriedade} 
Para qualquer linha (de um mapa), a sua representação  deve conter um número de símbolos correspondentes a um tipo célula igual
ao número de vezes que esse tipo de célula aparece na linha em questão.
\end{propriedade}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{prop\char95 nmbrs}\;\Varid{l}\;\Varid{c}\mathrel{=}\bot {}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{count}\mathbin{::}(\Conid{Eq}\;\Varid{a})\Rightarrow \Varid{a}\to [\mskip1.5mu \Varid{a}\mskip1.5mu]\to \Conid{Int}{}\<[E]%
\\
\>[B]{}\Varid{count}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\begin{propriedade} 
Para qualquer lista \ensuremath{\Varid{l}} a função \ensuremath{\Varid{markMap}\;\Varid{l}} é idempotente.
\end{propriedade}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{inBounds}\;\Varid{m}\;(\Varid{x},\Varid{y})\mathrel{=}\bot {}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{prop\char95 idemp2}\;\Varid{l}\;\Varid{m}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\begin{propriedade} 
Todas as posições presentes na lista dada como argumento irão fazer com que
as células correspondentes no mapa deixem de ser \ensuremath{\Conid{Free}}.
\end{propriedade}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{prop\char95 extr2}\;\Varid{l}\;\Varid{m}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks

\begin{propriedade} 
Quanto maior for o tamanho máximo dos caminhos  mais caminhos que alcançam a
posição alvo iremos encontrar:
\end{propriedade}
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{prop\char95 reach}\;\Varid{m}\;\Varid{t}\;\Varid{n}\;\Varid{n'}\mathrel{=}\bot {}\<[E]%
\ColumnHook
\end{hscode}\resethooks


%----------------- Índice remissivo (exige makeindex) -------------------------%

\printindex

%----------------- Bibliografia (exige bibtex) --------------------------------%

\bibliographystyle{plain}
\bibliography{cp2122t}

%----------------- Fim do documento -------------------------------------------%
\end{document}
